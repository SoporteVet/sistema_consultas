<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consentimiento Ces치rea</title>
    <style>
        :root {
            --primary-color: #3a7ca5;
            --secondary-color: #f8f9fa;
            --accent-color: #63c5da;
            --text-color: #2c3e50;
            --border-color: #d1e7f0;
            --highlight-color: #e3f2fd;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --input-bg: #f0f7fa;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            background-color: #f5f7fa;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #e4eff5 100%);
            min-height: 100vh;
        }
        
        .container {
            width: 800px;
            margin: 0 auto 40px;
            padding: 30px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background-color: white;
            box-shadow: 0 5px 20px var(--shadow-color);
            transition: box-shadow 0.3s ease;
        }
        
        .container:hover { 
            box-shadow: 0 8px 25px var(--shadow-color); 
        }
        
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 3px solid var(--accent-color);
            padding-bottom: 15px;
            justify-content: space-between;
        }
        
        .logo { 
            max-width: 80px; 
            margin-right: 15px; 
            border-radius: 10px; 
            box-shadow: 0 2px 5px var(--shadow-color); 
        }
        
        h1 { 
            text-align: center; 
            margin-bottom: 30px; 
            color: var(--primary-color); 
            flex-grow: 1; 
            font-size: 1.6rem; 
            text-shadow: 1px 1px 2px var(--shadow-color); 
        }
        
        p { 
            margin-bottom: 20px; 
            text-align: justify; 
            color: var(--text-color); 
            line-height: 1.8; 
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(135deg, var(--secondary-color), #ffffff);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px var(--shadow-color);
        }
        
        .data-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 5px;
        }
        
        .data-row {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .data-row label {
            font-weight: bold;
            color: var(--text-color);
            margin-right: 10px;
            min-width: 80px;
        }
        
        input[type="text"], input[type="email"], input[type="date"], input[type="tel"] {
            border: none;
            border-bottom: 2px solid var(--border-color);
            background-color: var(--input-bg);
            padding: 8px 12px;
            margin: 0;
            font-weight: bold;
            min-height: 35px;
            border-radius: 6px 6px 0 0;
            flex: 1;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }
        
        input[type="text"]:focus, input[type="email"]:focus, input[type="date"]:focus, input[type="tel"]:focus {
            outline: none;
            border-bottom-color: var(--primary-color);
            background-color: var(--highlight-color);
            box-shadow: 0 3px 8px var(--shadow-color);
        }
        
        .signature-area {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .firma-container { 
            flex: 1 1 300px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        
        .signature-box { 
            width: 100%; 
            padding: 10px; 
            text-align: center; 
            margin-bottom: 10px; 
            border-radius: 5px; 
            background-color: var(--secondary-color); 
            color: var(--text-color); 
            font-weight: 500; 
        }
        
        .signature-pad-container { 
            width: 100%; 
        }
        
        .signature-pad { 
            border: 2px dashed var(--border-color); 
            border-radius: 8px; 
            width: 100%; 
            height: 200px; 
            background-color: white; 
            touch-action: none; 
            user-select: none; 
            box-shadow: 0 2px 8px var(--shadow-color); 
            transition: border 0.3s ease; 
        }
        
        .signature-pad:hover { 
            border-color: var(--accent-color); 
        }
        
        .signature-buttons { 
            display: flex; 
            margin-top: 10px; 
            gap: 10px; 
            justify-content: center; 
        }
        
        .signature-buttons button {
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
        }
        
        .signature-buttons button:hover {
            background-color: var(--accent-color);
        }
        
        .pdf-button-container { 
            text-align: center; 
            margin-top: 30px; 
            padding-top: 20px; 
            border-top: 1px dashed var(--border-color); 
        }
        
        .pdf-button { 
            padding: 12px 25px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: bold; 
            transition: all 0.3s ease; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.15); 
        }
        
        .pdf-button:hover { 
            background-color: #45a049; 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
        }
        
        .pdf-button:active { 
            transform: translateY(0); 
        }
        
        .date-short {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9em;
            color: #666;
        }
        
        .autocomplete-banner {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 1px solid #2196f3;
            color: #1565c0;
            padding: 12px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(33,150,243,0.15);
        }
        
        .autocomplete-banner strong {
            color: #0d47a1;
        }
        
        input[type="text"]:-webkit-autofill,
        input[type="text"]:-webkit-autofill:hover,
        input[type="text"]:-webkit-autofill:focus {
            -webkit-box-shadow: 0 0 0px 1000px white inset;
            -webkit-text-fill-color: var(--text-color) !important;
            background: white !important;
        }
        
        .page-break {
            page-break-before: always;
            margin-top: 50px;
        }
        
        @media print {
            body { 
                background-color: white; 
                margin: 0; 
                padding: 0; 
            }
            .container { 
                box-shadow: none; 
                border: none; 
                padding: 10px; 
                margin: 0;
                width: 100%;
            }
            .signature-buttons, 
            .pdf-button-container, 
            .autocomplete-banner { 
                display: none !important; 
            }
            .page-break {
                margin-top: 0;
            }
            .data-grid {
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }
        
        @media (max-width: 600px) {
            .header { 
                flex-direction: column; 
                text-align: center; 
            }
            .signature-area { 
                flex-direction: column; 
            }
            .firma-container { 
                width: 100%; 
            }
            .data-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- P치gina 1 -->
    <div class="container" id="cesareaPage1">
        <div class="autocomplete-banner" id="autocompleteBanner">
            <strong>游댃 Autocompletado:</strong> Los datos se completar치n autom치ticamente desde el sistema de tickets veterinario.
        </div>
        
        <div class="header">
            <img src="logo.jpg" alt="Veterinaria San Martin de Porres" class="logo">
            <h1>CONSENTIMIENTO INFORMADO PARA CES츼REA EN MASCOTAS</h1>
            <div id="shortDate" class="date-short"></div>
        </div>

        <div class="data-grid">
            <div class="data-section">
                <h3>游늶 Datos del Propietario</h3>
                <div class="data-row">
                    <label>Nombre:</label>
                    <input type="text" id="ownerName" placeholder="Nombre completo del propietario" required>
                </div>
                <div class="data-row">
                    <label>C칠dula:</label>
                    <input type="text" id="ownerCedula" placeholder="N칰mero de c칠dula">
                </div>
                <div class="data-row">
                    <label>Tel칠fono:</label>
                    <input type="tel" id="ownerPhone" placeholder="N칰mero de tel칠fono">
                </div>
                <div class="data-row">
                    <label>Email:</label>
                    <input type="email" id="ownerEmail" placeholder="Correo electr칩nico">
                </div>
            </div>

            <div class="data-section">
                <h3>游냇 Datos de la Mascota</h3>
                <div class="data-row">
                    <label>Nombre:</label>
                    <input type="text" id="petName" placeholder="Nombre de la mascota" required>
                </div>
                <div class="data-row">
                    <label>Raza:</label>
                    <input type="text" id="petBreed" placeholder="Raza de la mascota">
                </div>
                <div class="data-row">
                    <label>Edad:</label>
                    <input type="text" id="petAge" placeholder="Edad de la mascota">
                </div>
                <div class="data-row">
                    <label>Expediente:</label>
                    <input type="text" id="expedientNumber" placeholder="N춿 de expediente">
                </div>
            </div>
        </div>

        <p>
            Yo, <strong id="ownerNameText">[Nombre del propietario]</strong>, propietario(a) de la mascota <strong id="petNameText">[Nombre de la mascota]</strong>, de la raza <strong id="petBreedText">[Raza]</strong>, declaro que he sido debidamente informado sobre el procedimiento quir칰rgico de ces치rea que se realizar치 a mi mascota, as칤 como los posibles riesgos y complicaciones que pueden presentarse, tanto para la madre como para sus cr칤as.
        </p>

        <p>
            <strong>1. RIESGOS DE LA CIRUG칈A Y LA ANESTESIA</strong>
        </p>

        <p>
            Soy consciente de que cualquier procedimiento quir칰rgico y anest칠sico conlleva riesgos, incluyendo pero no limit치ndose a bradicardia, hipotermia, hipovolemia, hemorragias activas, par치lisis, infecciones, reacciones adversas a la anestesia, desbalance electrol칤tico, anemia, necrosis tisular, sepsis, hipocalcemia, paro cardiorrespiratorio y fallecimiento tanto de la madre como de uno o varios cachorros, ya sea durante la cirug칤a, en el postquir칰rgico inmediato o posteriormente en el hogar. Adem치s, acepto que podr칤an ser necesarias intervenciones adicionales o ex치menes complementarios si el equipo m칠dico lo considera apropiado.
        </p>

        <p>
            <strong>2. RIESGOS RELACIONADOS CON LOS CACHORROS</strong>
        </p>

        <p>
            Entiendo que los cachorros pueden nacer con enfermedades gen칠ticas o adquiridas tales como paladar hendido, labio leporino, cardiopat칤as, neuropat칤as, s칤ndrome del nadador, anasarca, hernias, ectopia cordis, hidrocefalia, pectus excavatum, aplasia cutis cong칠nita, as칤 como diversas afecciones musculoesquel칠ticas, oculares, sangu칤neas, entre otras. Muchos de estos padecimientos no se pueden detectar ni antes ni al momento del nacimiento, y no se garantiza la viabilidad ni el estado de salud de todos los neonatos.
        </p>
    </div>

    <!-- P치gina 2 -->
    <div class="container page-break" id="cesareaPage2">
        <div class="header">
            <img src="logo.jpg" alt="Veterinaria San Martin de Porres" class="logo">
            <h1>CONSENTIMIENTO INFORMADO PARA CES츼REA</h1>
            <div id="shortDate2" class="date-short"></div>
        </div>

        <p>
            <strong>3. LIMITACIONES DE LA MEDICINA VETERINARIA:</strong> Estoy completamente claro(a) de que, pese a todos los esfuerzos m칠dicos, la realizaci칩n de ex치menes de sangre complementarios, ultrasonidos y radiograf칤as, mi mascota podr칤a llegar a presentar complicaciones en cualquier momento que podr칤an comprometer su vida.
        </p>

        <p>
            <strong>4. PROCESO DE RECUPERACI칍N:</strong> Comprendo que la recuperaci칩n de mi mascota depender치 de su estado de salud general y del cumplimiento estricto de las indicaciones y cuidados posteriores a su egreso. Acepto la responsabilidad de seguir todas las recomendaciones m칠dicas para garantizar una recuperaci칩n exitosa.
        </p>

        <p>
            <strong>5. AUTORIZACI칍N PARA DECISIONES DE EMERGENCIA:</strong> Autorizo expresamente al equipo veterinario a tomar decisiones m칠dicas durante el procedimiento si identifican complicaciones imprevistas, siempre en el mejor inter칠s de la salud de mi mascota y sus cachorros.
        </p>

        <p>
            <strong>6. COSTOS ADICIONALES:</strong> Entiendo que cualquier procedimiento, medicamento o tratamiento adicional que sea necesario debido a complicaciones imprevistas generar치 costos adicionales que acepto asumir.
        </p>

        <p>
            <strong>DECLARACI칍N FINAL:</strong> Hago constar que comprendo completamente el procedimiento que se va a realizar, sus riesgos, beneficios y alternativas. Se me han explicado y aclarado todas las dudas que me han surgido al respecto. Dejo a mi mascota por voluntad propia y con pleno conocimiento de lo expuesto.
        </p>

        <p>
            Firmo este documento en pleno uso de mis facultades mentales, afirmando que he le칤do y comprendido todo lo descrito, a las <strong id="cesareaTime">[Hora]</strong> horas, del d칤a <strong id="cesareaDay">[D칤a]</strong> del mes de <strong id="cesareaMonth">[Mes]</strong> de <strong id="cesareaYear">[A침o]</strong>.
        </p>

        <div class="signature-area">
            <div class="firma-container">
                <div class="signature-box">Firma y c칠dula del propietario</div>
                <div class="signature-pad-container">
                    <canvas class="signature-pad" id="cesareaSigPad" style="touch-action: none;"></canvas>
                    <div class="signature-buttons">
                        <button type="button" onclick="clearSignature('cesareaSigPad')">Limpiar Firma</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="pdf-button-container">
            <button class="pdf-button" onclick="generatePDF()">Generar PDF</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Autocompletado desde URL
            const urlParams = new URLSearchParams(window.location.search);
            
            // Mapeo de par치metros est치ndar del sistema de tickets
            const autoFillMap = {
                'clienteNombre': 'ownerName',
                'clienteCedula': 'ownerCedula', 
                'clienteTelefono': 'ownerPhone',
                'clienteEmail': 'ownerEmail',
                'mascotaNombre': 'petName',
                'mascotaRaza': 'petBreed',
                'mascotaEdad': 'petAge',
                'expediente': 'expedientNumber'
            };

            // Autocompletar campos
            Object.entries(autoFillMap).forEach(([urlParam, fieldId]) => {
                const value = urlParams.get(urlParam);
                if (value) {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.value = decodeURIComponent(value);
                    }
                }
            });

            // Sincronizar datos en texto
            function syncData() {
                const fields = ['ownerName', 'ownerCedula', 'petName', 'petBreed', 'expedientNumber'];
                fields.forEach(field => {
                    const input = document.getElementById(field);
                    const textSpan = document.getElementById(field + 'Text');
                    if (input && textSpan) {
                        textSpan.textContent = input.value || `[${input.placeholder}]`;
                        input.addEventListener('input', () => {
                            textSpan.textContent = input.value || `[${input.placeholder}]`;
                        });
                    }
                });
            }

            // Ocultar banner si hay datos autocompletados
            const hasAutoData = Object.values(autoFillMap).some(fieldId => 
                document.getElementById(fieldId)?.value
            );
            if (hasAutoData) {
                const banner = document.getElementById('autocompleteBanner');
                if (banner) banner.style.display = 'none';
            }

            // Inicializar fechas y horas
            const now = new Date();
            document.getElementById('shortDate').textContent = now.toLocaleDateString('es-ES');
            document.getElementById('shortDate2').textContent = now.toLocaleDateString('es-ES');
            document.getElementById('cesareaTime').textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('cesareaDay').textContent = now.getDate();
            document.getElementById('cesareaMonth').textContent = now.toLocaleString('es-ES', { month: 'long' });
            document.getElementById('cesareaYear').textContent = now.getFullYear();

            // Inicializar sincronizaci칩n de datos
            syncData();

            // Configurar firma digital
            const canvas = document.getElementById('cesareaSigPad');
            function resizeCanvas(c) {
                const ratio = Math.max(window.devicePixelRatio || 1, 2);
                c.width = c.offsetWidth * ratio;
                c.height = c.offsetHeight * ratio;
                c.getContext('2d').scale(ratio, ratio);
            }
            resizeCanvas(canvas);
            
            window.signaturePads = { 
                cesareaSigPad: new SignaturePad(canvas, {
                    backgroundColor: 'rgba(255,255,255,0)',
                    penColor: 'rgb(0,0,100)',
                    minWidth: 0.3,
                    maxWidth: 1.5
                }) 
            };
            
            window.addEventListener('resize', () => resizeCanvas(canvas));
        });

        function clearSignature(id) {
            window.signaturePads[id].clear();
        }

        async function generatePDF() {
            const ownerName = document.getElementById('ownerName').value;
            const petName = document.getElementById('petName').value;
            
            if (!ownerName || !petName) {
                alert('Por favor complete el nombre del propietario y de la mascota antes de generar el PDF.');
                return;
            }

            // Ocultar elementos no imprimibles
            const pdfBtn = document.querySelector('.pdf-button-container');
            const sigBtns = document.querySelectorAll('.signature-buttons');
            const banner = document.getElementById('autocompleteBanner');
            
            const originalPdfDisplay = pdfBtn.style.display;
            const originalSigDisplays = Array.from(sigBtns).map(b => b.style.display);
            const originalBannerDisplay = banner ? banner.style.display : 'none';
            
            pdfBtn.style.display = 'none';
            sigBtns.forEach(b => b.style.display = 'none');
            if (banner) banner.style.display = 'none';

            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // P치gina 1
                const page1 = document.getElementById('cesareaPage1');
                const canvas1 = await html2canvas(page1, { 
                    scale: 1.5, 
                    useCORS: true, 
                    backgroundColor: '#fff',
                    width: page1.scrollWidth,
                    height: page1.scrollHeight
                });
                
                const img1 = canvas1.toDataURL('image/jpeg', 0.8);
                const imgW = 190;
                const imgH1 = (canvas1.height * imgW) / canvas1.width;
                pdf.addImage(img1, 'JPEG', 10, 10, imgW, imgH1);
                
                // P치gina 2
                pdf.addPage();
                const page2 = document.getElementById('cesareaPage2');
                const canvas2 = await html2canvas(page2, { 
                    scale: 1.5, 
                    useCORS: true, 
                    backgroundColor: '#fff',
                    width: page2.scrollWidth,
                    height: page2.scrollHeight
                });
                
                const img2 = canvas2.toDataURL('image/jpeg', 0.8);
                const imgH2 = (canvas2.height * imgW) / canvas2.width;
                pdf.addImage(img2, 'JPEG', 10, 10, imgW, imgH2);
                
                // Guardar PDF
                const fileName = `Consentimiento_Cesarea_${petName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                pdf.save(fileName);
                
            } catch (error) {
                console.error('Error generando PDF:', error);
                alert('Hubo un problema al generar el PDF. Por favor, int칠ntelo de nuevo.');
            } finally {
                // Restaurar elementos ocultos
                pdfBtn.style.display = originalPdfDisplay;
                sigBtns.forEach((b, i) => b.style.display = originalSigDisplays[i]);
                if (banner) banner.style.display = originalBannerDisplay;
            }
        }
    </script>
</body>
</html>
