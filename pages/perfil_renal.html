<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Plantillas</title>
    <link rel="stylesheet" href="index_lab.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=ABeeZee:ital@0;1&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=League+Spartan:wght@100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
</head>
<body>
<script>
// Autollenado Perfil Renal
document.addEventListener('DOMContentLoaded', function(){
  try {
    const p = new URLSearchParams(location.search);
    const setVal = (id, v) => { const el = document.getElementById(id); if (el && v) el.value = v; };
    setVal('mascotaNombre', p.get('mascotaNombre'));
    setVal('propietarioNombre', p.get('propietarioNombre'));
    setVal('propietarioCedula', p.get('propietarioCedula'));
    setVal('propietarioTelefono', p.get('propietarioTelefono'));
    setVal('propietarioEmail', p.get('propietarioEmail'));
    setVal('nombreMedico', p.get('nombreMedico'));
    setVal('mascotaRaza', p.get('mascotaRaza'));
    setVal('mascotaEdad', p.get('mascotaEdad'));
    setVal('mascotaPeso', p.get('mascotaPeso'));
    
    // Verificar el mensaje del médico después del autollenado
    const medico = p.get('nombreMedico');
    if (medico) {
      setTimeout(() => {
        verificarMedico();
      }, 100);
    }
  } catch(e){}
});
</script>
    <body>
        <div class="controls no-print">
            <label for="sexoSelector">Selecciona el sexo:</label>
            <select id="sexoSelector" onchange="actualizarSexoEnPlantilla(),actualizarValoresReferencia2()">
                <option value="Seleccionar" selected>-- Seleccionar --</option>
                <option value="Macho">Macho</option>
                <option value="Hembra">Hembra</option>
            </select>
            <label for="especieSelector">Selecciona la especie:</label>
            <select id="especieSelector" onchange="actualizarEspecieEnPlantilla(),actualizarValoresReferencia2()">
                <option value="Seleccionar" selected>-- Seleccionar --</option>
                <option value="Canino">Canino</option>
                <option value="Felino">Felino</option>
                <option value="Lagomorfo">Lagomorfo</option>
                <option value="Cuilo">Cuilo</option>
            </select>
            <label for="edadSelector">Selecciona el rango de edad:</label>
            <select id="edadSelector" onchange="actualizarValoresReferencia2()">
                <option value="Seleccionar" selected>-- Seleccionar --</option>
                <option value="De 1 año a 20 años">De 1 año a 12 años</option>
                <option value="De 6 meses a 1 año">De 6 meses a 1 año</option>
                <option value="De 3 meses a 6 meses">De 3 meses a 6 meses</option>
                <option value="De 0 mes a 1,5 meses">De 0 mes a 1,5 meses</option>
                <option value="Todas las edades">Todas las edades</option>
            </select>
        </div>
        <div class="container" id="template1" style="display: block;">
        <div class="header">
            <img src="empresa.jpg" alt="Logo de la Empresa" class="small-image">
            <h1>Laboratorio Clínico Veterinario</h1>
        </div>
        <h3 class="subheader perfil-renal-titulo">PERFIL RENAL COMPLETO</h3>
            <table>
                <thead>
                    <tr>
                        <th colspan="2">DATOS DE LA MASCOTA</th>
                        <th colspan="2">DATOS DEL PROPIETARIO</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Nombre</td>
                        <td><input type="text" id="mascotaNombre" onkeydown="moverFocoConFlechas(event, 'propietarioNombre', 'propietarioNombre', 'mascotaNombre', 'mascotaRaza')"></td>
                        <td>Nombre</td>
                        <td><input type="text" id="propietarioNombre"  onkeydown="moverFocoConFlechas(event, 'propietarioCedula', 'mascotaNombre', 'mascotaNombre', 'propietarioCedula')"></td>
                    </tr>
                    <tr>
                        <td>Raza</td>
                        <td><input type="text" id="mascotaRaza" list="razas"  onkeydown="moverFocoConFlechas(event, 'propietarioCedula', 'mascotaNombre', 'mascotaNombre', 'mascotaSexo')"></td>
                        <datalist id="razas">

                        </datalist>
                        <td>Cédula</td>
                        <td><input type="text" id="propietarioCedula"  onkeydown="moverFocoConFlechas(event, 'propietarioTelefono', 'mascotaRaza', 'propietarioNombre', 'propietarioTelefono')"></td>
                    </tr>
                    <tr>
                        <td>Sexo</td>
                        <td><input type="text" id="sexoEnPlantilla"></td>
                        <td>Teléfono</td>
                        <td><input type="text" id="propietarioTelefono" onkeydown="moverFocoConFlechas(event, 'propietarioCedula', 'mascotaSexo', 'propietarioCedula', 'propietarioEmail')"></td>
                    </tr>
                    <tr>
                        <td>Especie</td>
                        <td><input type="text" id="especieEnPlantilla"></td>
                        <td>Email</td>
                        <td><input type="text" id="propietarioEmail"  onkeydown="moverFocoConFlechas(event, 'mascotaEspecie', 'mascotaEspecie', 'propietarioTelefono', 'nombreMedico')"></td>
                    </tr>
                    <tr>
                        <td>Edad</td>
                        <td><input type="text" id="mascotaEdad" list="edades"  onkeydown="moverFocoConFlechas(event, 'nombreMedico', 'mascotaEspecie', 'mascotaEspecie', 'mascotaPeso')"></td>
    
                        <datalist id="edades">
                        <option value="1 mes"><option value="2 meses"><option value="3 meses"><option value="4 meses">
                        <option value="5 meses"><option value="6 meses"><option value="7 meses"><option value="8 meses"><option value="9 meses">
                        <option value="10 meses"><option value="11 meses"><option value="12 meses">
                        <option value="1 año"><option value="2 años"><option value="3 años"><option value="4 años">
                        <option value="5 años"><option value="6 años"><option value="7 años"><option value="8 años"><option value="9 años">
                        <option value="10 años"><option value="11 años"><option value="12 años"><option value="13 años"></option><option value="14 años"></option>
                        <option value="15 años"><option value="16 años"><option value="17 años"><option value="18 años"></option>
                        <option value="19 años"><option value="20 años"></option>    
                    </datalist>
                        <td>Médico</td>
                        <td>
                            <input type="text" id="nombreMedico" list="medicos" 
                                onkeydown="moverFocoConFlechas(event, 'propietarioFecha', 'mascotaEdad', 'propietarioEmail', 'propietarioFecha')" 
                                oninput="verificarMedico()">
                        </td>
                        <datalist id="medicos">
                            <option value="N.A">
                            <option value="Dr. Randall Azofeifa">
                            <option value="Dr. Luis Coto">
                            <option value="Dra. Daniela Sancho">
                            <option value="Dra. Sofia Carrillo">
                            <option value="Dra. Franciny Nuñez">
                            <option value="Dra. Maria Chacón">
                            <option value="Dra. Alejandra León">
                            <option value="Dra. Karla Quesada">
                            <option value="Dra. Kharen Moreno">
                            <option value="Dra. Karina Madrigal">
                            <option value="Dra. Natalia Alvarado">
                        </datalist>
                    </tr>
                    <tr>
                        <script>    
                            function actualizarSexoEnPlantilla() {
                                const sexo = document.getElementById('sexoSelector').value;
                                document.getElementById('sexoEnPlantilla').value = sexo.charAt(0).toUpperCase() + sexo.slice(1);
                            }
                            function actualizarEspecieEnPlantilla() {
                                const especie = document.getElementById('especieSelector').value;
                                document.getElementById('especieEnPlantilla').value = especie;
                            }
                            function verificarMedico() {
                                const medico = document.getElementById('nombreMedico').value;
                                const mensaje = document.getElementById('mensajeMedico');
                                if (medico === 'N.A' || medico === 'NA' || medico === '' || medico === 'N.A.' || medico.toLowerCase() === 'na') {
                                    mensaje.style.display = 'none';
                                } else {
                                    mensaje.style.display = 'block';
                                }
                            }
                            
                            </script>
                    </tr>
                    <tr>
                        <td>Peso</td>
    <td><input type="text" id="mascotaPeso" list="pesos" onkeydown="moverFocoConFlechas(event, 'propietarioFecha', 'mascotaEdad', 'mascotaEdad', 'mascotaPeso')"></td>
    
        <datalist id="pesos">
            <option value="N.A">N.A</option><option value="0,1 kg">0,1 kg</option><option value="0,2 kg">0,2 kg</option><option value="0,3 kg">0,3 kg</option><option value="0,4 kg">0,4 kg</option>
            <option value="0,5 kg">0,5 kg</option><option value="0,6 kg">0,6 kg</option><option value="0,7 kg">0,7 kg</option><option value="0,8 kg">0,8 kg</option><option value="0,9 kg">0,9 kg</option>
            <option value="1,0 kg">1,0 kg</option><option value="1,1 kg">1,1 kg</option><option value="1,2 kg">1,2 kg</option><option value="1,3 kg">1,3 kg</option><option value="1,4 kg">1,4 kg</option>
            <option value="1,5 kg">1,5 kg</option><option value="1,6 kg">1,6 kg</option><option value="1,7 kg">1,7 kg</option><option value="1,8 kg">1,8 kg</option><option value="1,9 kg">1,9 kg</option>
            <option value="2,0 kg">2,0 kg</option><option value="2,1 kg">2,1 kg</option><option value="2,2 kg">2,2 kg</option><option value="2,3 kg">2,3 kg</option><option value="2,4 kg">2,4 kg</option>
            <option value="2,5 kg">2,5 kg</option><option value="2,6 kg">2,6 kg</option><option value="2,7 kg">2,7 kg</option><option value="2,8 kg">2,8 kg</option><option value="2,9 kg">2,9 kg</option>
            <option value="3,0 kg">3,0 kg</option><option value="3,1 kg">3,1 kg</option><option value="3,2 kg">3,2 kg</option><option value="3,3 kg">3,3 kg</option><option value="3,4 kg">3,4 kg</option>
            <option value="3,5 kg">3,5 kg</option><option value="3,6 kg">3,6 kg</option><option value="3,7 kg">3,7 kg</option><option value="3,8 kg">3,8 kg</option><option value="3,9 kg">3,9 kg</option>
            <option value="4,0 kg">4,0 kg</option><option value="4,1 kg">4,1 kg</option><option value="4,2 kg">4,2 kg</option><option value="4,3 kg">4,3 kg</option><option value="4,4 kg">4,4 kg</option>
            <option value="4,5 kg">4,5 kg</option><option value="4,6 kg">4,6 kg</option><option value="4,7 kg">4,7 kg</option><option value="4,8 kg">4,8 kg</option><option value="4,9 kg">4,9 kg</option>
            <option value="5,0 kg">5,0 kg</option><option value="5,1 kg">5,1 kg</option><option value="5,2 kg">5,2 kg</option><option value="5,3 kg">5,3 kg</option><option value="5,4 kg">5,4 kg</option>
            <option value="5,5 kg">5,5 kg</option><option value="5,6 kg">5,6 kg</option><option value="5,7 kg">5,7 kg</option><option value="5,8 kg">5,8 kg</option><option value="5,9 kg">5,9 kg</option>
            <option value="6,0 kg">6,0 kg</option><option value="6,1 kg">6,1 kg</option><option value="6,2 kg">6,2 kg</option><option value="6,3 kg">6,3 kg</option><option value="6,4 kg">6,4 kg</option>
            <option value="6,5 kg">6,5 kg</option><option value="6,6 kg">6,6 kg</option><option value="6,7 kg">6,7 kg</option><option value="6,8 kg">6,8 kg</option><option value="6,9 kg">6,9 kg</option>
            <option value="7,0 kg">7,0 kg</option><option value="7,1 kg">7,1 kg</option><option value="7,2 kg">7,2 kg</option><option value="7,3 kg">7,3 kg</option><option value="7,4 kg">7,4 kg</option>
            <option value="7,5 kg">7,5 kg</option><option value="7,6 kg">7,6 kg</option><option value="7,7 kg">7,7 kg</option><option value="7,8 kg">7,8 kg</option><option value="7,9 kg">7,9 kg</option>
            <option value="8,0 kg">8,0 kg</option><option value="8,1 kg">8,1 kg</option><option value="8,2 kg">8,2 kg</option><option value="8,3 kg">8,3 kg</option><option value="8,4 kg">8,4 kg</option>
            <option value="8,5 kg">8,5 kg</option><option value="8,6 kg">8,6 kg</option><option value="8,7 kg">8,7 kg</option><option value="8,8 kg">8,8 kg</option><option value="8,9 kg">8,9 kg</option>
            <option value="9,0 kg">9,0 kg</option><option value="9,1 kg">9,1 kg</option><option value="9,2 kg">9,2 kg</option><option value="9,3 kg">9,3 kg</option><option value="9,4 kg">9,4 kg</option>
            <option value="9,5 kg">9,5 kg</option><option value="9,6 kg">9,6 kg</option><option value="9,7 kg">9,7 kg</option><option value="9,8 kg">9,8 kg</option><option value="9,9 kg">9,9 kg</option>
            <option value="10,0 kg">10,0 kg</option><option value="10,1 kg">10,1 kg</option><option value="10,2 kg">10,2 kg</option><option value="10,3 kg">10,3 kg</option><option value="10,4 kg">10,4 kg</option>
            <option value="10,5 kg">10,5 kg</option><option value="10,6 kg">10,6 kg</option><option value="10,7 kg">10,7 kg</option><option value="10,8 kg">10,8 kg</option><option value="10,9 kg">10,9 kg</option>
            <option value="11,0 kg">11,0 kg</option><option value="11,1 kg">11,1 kg</option><option value="11,2 kg">11,2 kg</option><option value="11,3 kg">11,3 kg</option><option value="11,4 kg">11,4 kg</option>
            <option value="11,5 kg">11,5 kg</option><option value="11,6 kg">11,6 kg</option><option value="11,7 kg">11,7 kg</option><option value="11,8 kg">11,8 kg</option><option value="11,9 kg">11,9 kg</option>
            <option value="12,0 kg">12,0 kg</option>
            
        </datalist>
            <td>Fecha</td>
            <td><input type="date" id="propietarioFecha" class="date-input" onkeydown="moverFocoConFlechas(event, 'nombreMedico', 'mascotaPeso', 'nombreMedico', 'propietarioFecha')"></td>
                    </tr>
                    
                    <script>
                  function formatearFecha(input) {
                const fecha = new Date(input.value);
                const dia = String(fecha.getDate()).padStart(2, '0');
                const mes = String(fecha.getMonth() + 1).padStart(2, '0');
                const año = fecha.getFullYear();
                input.value = `${dia}-${mes}-${año}`;
            }
       
            function moverFocoConFlechas(event, derechaId, izquierdaId, arribaId, abajoId) {
                    switch (event.key) {
                        case 'ArrowRight':
                            event.preventDefault();
                            document.getElementById(derechaId).focus();
                            break;
                        case 'ArrowLeft':
                            event.preventDefault();
                            document.getElementById(izquierdaId).focus();
                            break;
                        case 'ArrowUp':
                            event.preventDefault();
                            document.getElementById(arribaId).focus();
                            break;
                        case 'Enter':
                        case 'ArrowDown':
                            event.preventDefault();
                            document.getElementById(abajoId).focus();
                            break;
                    }
                }
                const razasCaninas = [
    "Ainu", "Airedale terrier", "Akita", "Akita Inu", "Alaskan Malamute",
    "American Black and Tan Coonhound", "American Bull Terrier", "American Pit Bull Terrier",
    "American Staffordshire terrier", "American Water Spaniel", "Apso Tibetano", "Barzoi", 
    "Basenji", "Basset Hound", "Beagle", "Bichon Frise", "Bloodhound", "Bobtail", 
    "Border Collie", "Boston Terrier", "Bouvier des Flandres", "Boxer", "Bull terrier", 
    "Bull Terrier Miniatura", "Bulldog Americano", "Bulldog Francés", "Bulldog Inglés", 
    "Bullmastiff", "Cavalier King Charles Spaniel", "Chihuahua", "Chow Chow", 
    "Cocker Spaniel Americano", "Cocker Spaniel Inglés", "Collie", "Collie Escocés", 
    "Dachshund", "Dálmata", "Doberman", "Doberman Pincher", "Dogo Alemán", 
    "Dogo Argentino", "Dogo de Burdeos", "French Poodle", "Galgo Español", 
    "Galgo Inglés-español", "Golden Retriever", "Gran Danés", "Greyhound", 
    "Husky Siberiano", "Jack Russell Terrier", "Labrador Retriever", "Maltés", 
    "Pastor Alemán", "Pequinés", "Pomerania", "Pug", "Rottweiler", "Samoyedo", 
    "San Bernardo", "Schnauzer", "Shih Tzu", "SRD", "Yorkshire Terrier", "Weimaraner", "Fila Brasileiro",
];

const razasFelinas = [
    "Abisinio", "American Bobtail", "Angora Turco", "Azul Ruso", "Balinés", 
    "Bengalí", "Bobtail japonés", "Bombay", "British Shorthair", "Burmés", 
    "Carey", "Común Europeo", "Exótico", "Himalayo", "Javanés", 
    "Oriental", "Persa", "Sagrado de Birmania", "Siamés", "Siberiano", 
    "Silvestre", "SRD"
];
// Reemplazar la función de reemplazo de punto por coma
function reemplazarPuntoPorComa() {
    // Obtener todos los campos numéricos
    const camposNumericos = [
        'Glucosa', 'Colesterol_total', 'amilasa', 'CK', 
        'nitrogeno_ureico', 'urea', 'creatinina', 'bun_crea', 'fosforo', 'calcio',
        'ALT', 'Fosfatasa_Alcalina', 'billirrubina_total', 'Albumina',
        'proteinas_totales', 'Globulinas', 'alb/glo'
    ];
    
    // Aplicar la funcionalidad a cada campo
    camposNumericos.forEach(id => {
        const campo = document.getElementById(id);
        if (campo) {
            // Usar keydown en lugar de input
            campo.addEventListener('keydown', function(event) {
                // Solo actuar cuando se presiona la tecla punto
                if (event.key === '.') {
                    event.preventDefault(); // Prevenir la acción por defecto
                    
                    // Obtener la posición actual del cursor
                    const cursorPos = this.selectionStart;
                    
                    // Obtener el valor actual e insertar una coma en lugar del punto
                    const valorActual = this.value;
                    const nuevoValor = valorActual.slice(0, cursorPos) + ',' + valorActual.slice(cursorPos);
                    
                    // Establecer el nuevo valor
                    this.value = nuevoValor;
                    
                    // Restaurar la posición del cursor justo después de la coma
                    setTimeout(() => {
                        this.setSelectionRange(cursorPos + 1, cursorPos + 1);
                    }, 0);
                }
            });
            
            // Mover las actualizaciones de color y cálculos al evento blur
            campo.addEventListener('blur', function() {
                actualizarColor(id, 'ref' + id.toLowerCase());
                if (id === 'Albumina' || id === 'proteinas_totales') {
                    calculateValues();
                }
            });
            
            // Eliminar cualquier evento input que pueda interferir
            const oldInputListeners = campo._inputListeners || [];
            oldInputListeners.forEach(listener => {
                campo.removeEventListener('input', listener);
            });
        }
    });
}

// Ejecutar cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
    reemplazarPuntoPorComa();
});
// Función para actualizar el datalist de razas según la especie seleccionada
function actualizarRazasPorEspecie() {
    const especie = document.getElementById('especieSelector').value;
    // Crear el datalist si no existe
    let datalistRazas = document.getElementById('razas');
    if (!datalistRazas) {
        datalistRazas = document.createElement('datalist');
        datalistRazas.id = 'razas';
        document.body.appendChild(datalistRazas);
    } else {
        // Limpiar la lista actual
        datalistRazas.innerHTML = '';
    }
    
    const campoRaza = document.getElementById('mascotaRaza');
    
    // Restablecer el campo de raza si se cambia la especie
    if (campoRaza.value && campoRaza.value !== "SRD") {
        campoRaza.value = '';
    }
    
    // Agregar las razas según la especie seleccionada
    if (especie === "Canino") {
        razasCaninas.forEach(raza => {
            const option = document.createElement('option');
            option.value = raza;
            datalistRazas.appendChild(option);
        });
    } else if (especie === "Felino") {
        razasFelinas.forEach(raza => {
            const option = document.createElement('option');
            option.value = raza;
            datalistRazas.appendChild(option);
        });
    } else if (especie === "Lagomorfo" || especie === "Cuilo") {
        // Para otras especies, agregar solo opciones genéricas
        const option = document.createElement('option');
        option.value = "SRD";
        datalistRazas.appendChild(option);
    }
}

// Modificar la función existente
function actualizarEspecieEnPlantilla() {
    const especie = document.getElementById('especieSelector').value;
    document.getElementById('especieEnPlantilla').value = especie;
    
    // Actualizar las razas disponibles según la especie
    actualizarRazasPorEspecie();
}

// Ejecutar al cargar la página
document.addEventListener('DOMContentLoaded', function() {
    // Asegurarse de que existe el selector de especies
    const especieSelector = document.getElementById('especieSelector');
    if (especieSelector) {
        // Si ya hay una especie seleccionada al cargar
        if (especieSelector.value !== "Seleccionar") {
            actualizarRazasPorEspecie();
        }
        
        // Agregar un listener adicional para garantizar que se actualicen las razas
        especieSelector.addEventListener('change', actualizarRazasPorEspecie);
    }
    
    // Crear datalist si no existe
    if (!document.getElementById('razas')) {
        const datalist = document.createElement('datalist');
        datalist.id = 'razas';
        document.body.appendChild(datalist);
    }
});

            
                    </script>
                </tbody>
            </table>

                <style>
    h1 {
        margin-top: 0;
        margin-bottom: 10px;
        font-weight: bold;
        text-align: center;
    }
    .subheader {
        margin-top: 12px;
        margin-bottom: 18px;
        font-weight: bold;
        text-align: center;
    }
    .perfil-renal-titulo {
        margin-top: -35px !important;
    }
    .tabla-renal {
        margin-bottom: 32px;
    }
    
    .field-row.deleted {
        display: none;
    }
    
    .restore-controls {
        text-align: center;
        margin: 20px 0;
        padding: 10px;
        background-color: #f0f0f0;
        border-radius: 5px;
    }
    
    .restore-btn {
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 3px;
        padding: 5px 10px;
        cursor: pointer;
        font-size: 12px;
        margin: 2px;
    }
    
    .restore-btn:hover {
        background-color: #218838;
    }
    
    /* Estilos para el panel de eliminación de parámetros */
    .parameter-selector-panel {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        margin: 20px auto;
        max-width: 600px;
        text-align: center;
    }
    
    .selector-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .parameter-dropdown {
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        background-color: white;
        font-size: 14px;
        min-width: 250px;
    }
    
    .remove-param-btn {
        background-color: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 15px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
    }
    
    .remove-param-btn:hover {
        background-color: #c82333;
    }
    
    /* Clase para ocultar elementos al generar PDF */
    @media print, screen and (max-width: 0) {
        .no-print {
            display: none !important;
        }
    }
</style>
<h3 class="subheader">FUNCIONAMIENTO RENAL</h3>
<table class="tabla-renal" style="width:100%;text-align:center;">
    <thead>
        <tr>
            <th style="width:25%">&nbsp;</th>
            <th style="width:20%">RESULTADO</th>
            <th style="width:30%">VALOR DE REFERENCIA</th>
            <th style="width:15%">UNIDADES</th>
        </tr>
    </thead>
    <tbody>
        <tr class="field-row" id="row-glucosa"><td>Glucosa</td>
            <td><input type="text" id="Glucosa" onblur="actualizarColor('Glucosa','refglucosa')" onkeydown="moverFocoConFlechas(event, 'nitrogeno_ureico', 'NA', 'NA', 'nitrogeno_ureico')"></td>
            <td id="refglucosa">77 - 126</td>
            <td>mg/dl</td>
        </tr>
        <tr class="field-row" id="row-nitrogeno_ureico"><td>Nitrógeno Ureico</td>
            <td><input type="text" id="nitrogeno_ureico" onblur="actualizarColor('nitrogeno_ureico','refnitrogeno_ureico')" onkeydown="moverFocoConFlechas(event, 'urea', 'Glucosa', 'Glucosa', 'urea')"></td>
            <td id="refnitrogeno_ureico">10 - 24</td>
            <td>mg/dl</td>
        </tr>
        <tr class="field-row" id="row-urea"><td>Urea</td>
            <td><input type="text" id="urea" onblur="actualizarColor('urea','refurea')" onkeydown="moverFocoConFlechas(event, 'creatinina', 'nitrogeno_ureico', 'nitrogeno_ureico', 'creatinina')"></td>
            <td id="refurea">20 - 50</td>
            <td>mg/dl</td>
        </tr>
        <tr class="field-row" id="row-creatinina"><td>Creatinina</td>
            <td><input type="text" id="creatinina" onblur="actualizarColor('creatinina','refcreatinina')" onkeydown="moverFocoConFlechas(event, 'bun_crea', 'urea', 'urea', 'bun_crea')"></td>
            <td id="refcreatinina">0,7 - 1,2</td>
            <td>mg/dl</td>
        </tr>
        <tr class="field-row" id="row-bun_crea"><td>Relación BUN/Crea</td>
            <td><input type="text" id="bun_crea" onblur="actualizarColor('bun_crea','refbun_crea')" onkeydown="moverFocoConFlechas(event, 'acido_urico', 'creatinina', 'creatinina', 'acido_urico')"></td>
            <td id="refbun_crea">4,2 - 32,8</td>
            <td>mg/dl</td>
        </tr>
        <tr class="field-row" id="row-acido_urico"><td>Ácido Úrico</td>
            <td><input type="text" id="acido_urico" onblur="actualizarColor('acido_urico','refacido_urico')" onkeydown="moverFocoConFlechas(event, 'fosforo', 'bun_crea', 'bun_crea', 'fosforo')"></td>
            <td id="refacido_urico">0,6 - 1,3</td>
            <td>mg/dl</td>
        </tr>
        <tr class="field-row" id="row-fosforo"><td>Fósforo</td>
            <td><input type="text" id="fosforo" onblur="actualizarColor('fosforo','reffosforo')" onkeydown="moverFocoConFlechas(event, 'calcio', 'acido_urico', 'acido_urico', 'calcio')"></td>
            <td id="reffosforo">3,3 - 5,7</td>
            <td>mg/dl</td>
        </tr>
        <tr class="field-row" id="row-calcio"><td>Calcio</td>
            <td><input type="text" id="calcio" onblur="actualizarColor('calcio','refcalcio')" onkeydown="moverFocoConFlechas(event, 'magnesio', 'fosforo', 'fosforo', 'magnesio')"></td>
            <td id="refcalcio">9,1 - 10,8</td>
            <td>mg/dl</td>
        </tr>
        <tr class="field-row" id="row-magnesio"><td>Magnesio</td>
            <td><input type="text" id="magnesio" onblur="actualizarColor('magnesio','refmagnesio')" onkeydown="moverFocoConFlechas(event, 'sodio', 'calcio', 'calcio', 'sodio')"></td>
            <td id="refmagnesio">1,8 - 3,0</td>
            <td>mg/dl</td>
        </tr>
        <tr class="field-row" id="row-sodio"><td>Sodio</td>
            <td><input type="text" id="sodio" onblur="actualizarColor('sodio','refsodio')" onkeydown="moverFocoConFlechas(event, 'potasio', 'magnesio', 'magnesio', 'potasio')"></td>
            <td id="refsodio">140 - 161</td>
            <td>mmol/l</td>
        </tr>
        <tr class="field-row" id="row-potasio"><td>Potasio</td>
            <td><input type="text" id="potasio" onblur="actualizarColor('potasio','refpotasio')" onkeydown="moverFocoConFlechas(event, 'cloro', 'sodio', 'sodio', 'cloro')"></td>
            <td id="refpotasio">4,4 - 5,7</td>
            <td>mmol/l</td>
        </tr>
        <tr class="field-row" id="row-cloro"><td>Cloro</td>
            <td><input type="text" id="cloro" onblur="actualizarColor('cloro','refcloro')" onkeydown="moverFocoConFlechas(event, 'dioxido_carbono', 'potasio', 'potasio', 'dioxido_carbono')"></td>
            <td id="refcloro">105 - 125</td>
            <td>mmol/l</td>
        </tr>
        <tr class="field-row" id="row-dioxido_carbono"><td>Dióxido de Carbono</td>
            <td><input type="text" id="dioxido_carbono" onblur="actualizarColor('dioxido_carbono','refdioxido_carbono')" onkeydown="moverFocoConFlechas(event, 'na_k', 'cloro', 'cloro', 'na_k')"></td>
            <td id="refdioxido_carbono">12 - 27</td>
            <td>mmol/l</td>
        </tr>
        <tr class="field-row" id="row-na_k"><td>NA+/K+</td>
            <td><input type="text" id="na_k" onblur="actualizarColor('na_k','refna_k')" onkeydown="moverFocoConFlechas(event, 'NA', 'dioxido_carbono', 'dioxido_carbono', 'NA')"></td>
            <td id="refna_k">27 - 38</td>
            <td></td>
        </tr>
    </tbody>
</table>

<h3 class="subheader">ÍNDICES DE INTERFERENCIA</h3>
<table style="margin:auto;margin-top:32px;margin-bottom:40px;">
    <tr>
        <td>Suero Hemolítico:</td>
        <td>
            <input list="opcionesInterferencia" id="suero_hemolitico" name="suero_hemolitico" style="width:140px;">
            <datalist id="opcionesInterferencia">
                <option value="No se observa">
                <option value="Se observa">
            </datalist>
        </td>
    </tr>
    <tr>
        <td>Suero Lipémico:</td>
        <td>
            <input list="opcionesInterferencia" id="suero_lipemico" name="suero_lipemico" style="width:140px;">
        </td>
    </tr>
    <tr>
        <td>Suero Ictérico:</td>
        <td>
            <input list="opcionesInterferencia" id="suero_icterico" name="suero_icterico" style="width:140px;">
        </td>
    </tr>
</table>

<div class="restore-controls no-print" id="restoreControls" style="display: none;">
    <h4>Campos eliminados - Haga clic para restaurar:</h4>
    <div id="deletedFields"></div>
    <button onclick="restoreAllFields()" class="restore-btn" style="margin-top: 10px; background-color: #007bff;">Restaurar todos los campos</button>
</div>

<script>
// Lógica de colores y flechas igual que en el panel básico
function actualizarColor(inputId, refId) {
    const inputElement = document.getElementById(inputId);
    const refElement = document.getElementById(refId);
    if (!inputElement || !refElement || !refElement.textContent) return;
    let valorTexto = inputElement.value.trim();
    valorTexto = valorTexto.replace(/\s*[↑↓]$/, '');
    if (!valorTexto) {
        inputElement.style.color = 'black';
        inputElement.value = '';
        return;
    }
    let valor = parseFloat(valorTexto.replace(',', '.'));
    if (isNaN(valor)) {
        inputElement.style.color = 'black';
        return;
    }
    
    // Redondear a 1 decimal con lógica personalizada
    const valorRedondeado = redondearPersonalizado(valor);
    const valorTextoRedondeado = valorRedondeado.toString().replace('.', ',');
    
    const rangoTexto = refElement.textContent;
    const coincidencia = rangoTexto.match(/([\d,.]+)\s*-\s*([\d,.]+)/);
    if (coincidencia) {
        const min = parseFloat(coincidencia[1].replace(',', '.'));
        const max = parseFloat(coincidencia[2].replace(',', '.'));
        if (valorRedondeado < min) {
            inputElement.style.color = '#00bfff';
            inputElement.value = valorTextoRedondeado + ' ↓';
        } else if (valorRedondeado > max) {
            inputElement.style.color = 'red';
            inputElement.value = valorTextoRedondeado + ' ↑';
        } else {
            inputElement.style.color = 'black';
            inputElement.value = valorTextoRedondeado;
        }
    } else {
        inputElement.style.color = 'black';
        inputElement.value = valorTextoRedondeado;
    }
}

// Función de redondeo personalizado
function redondearPersonalizado(numero) {
    // Si ya tiene 1 decimal o menos, no hacer nada
    const numeroStr = numero.toString();
    const parteDecimal = numeroStr.split('.')[1];
    
    if (!parteDecimal || parteDecimal.length <= 1) {
        return numero;
    }
    
    // Si tiene más de 1 decimal, aplicar redondeo personalizado
    const multiplicado = numero * 10;
    const parteEntera = Math.floor(multiplicado);
    const decimal = multiplicado - parteEntera;
    
    // Si el segundo decimal es 5, redondear hacia abajo
    // Si es mayor que 5, redondear hacia arriba
    // Si es menor que 5, redondear hacia abajo
    if (decimal >= 0.6) {
        return (parteEntera + 1) / 10;
    } else {
        return parteEntera / 10;
    }
}
</script>
<script>
// Estructura de valores de referencia por sexo y rango de edad
const valoresReferenciaRenal = {
    'Macho': {
        'De 1 año a 20 años': {
            glucosa: {valor: '77 - 126', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '10 - 24', unidad: 'mg/dl'},
            urea: {valor: '20 - 50', unidad: 'mg/dl'},
            creatinina: {valor: '0,7 - 1,2', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,6 - 1,3', unidad: 'mg/dl'},
            fosforo: {valor: '3,3 - 5,7', unidad: 'mg/dl'},
            calcio: {valor: '9,1 - 10,8', unidad: 'mg/dl'},
            magnesio: {valor: '1,8 - 3,0', unidad: 'mg/dl'},
            sodio: {valor: '140 - 161', unidad: 'mmol/l'},
            potasio: {valor: '4,4 - 5,7', unidad: 'mmol/l'},
            cloro: {valor: '105 - 125', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '12 - 27', unidad: 'mmol/l'},
            na_k: {valor: '27 - 38', unidad: ''}
        },
        'De 6 meses a 1 año': {
            glucosa: {valor: '76 - 129', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '7,3 - 23,5', unidad: 'mg/dl'},
            urea: {valor: '20 - 50', unidad: 'mg/dl'},
            creatinina: {valor: '0,7 - 1,4', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,5 - 1,4', unidad: 'mg/dl'},
            fosforo: {valor: '4,8 - 9,0', unidad: 'mg/dl'},
            calcio: {valor: '9,2 - 13,0', unidad: 'mg/dl'},
            magnesio: {valor: '1,8 - 3,0', unidad: 'mg/dl'},
            sodio: {valor: '137 - 163', unidad: 'mmol/l'},
            potasio: {valor: '4,2 - 5,7', unidad: 'mmol/l'},
            cloro: {valor: '105 - 125', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '12 - 27', unidad: 'mmol/l'},
            na_k: {valor: '27 - 38', unidad: ''}
        },
        'De 3 meses a 6 meses': {
            glucosa: {valor: '88 - 133', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '7 - 19', unidad: 'mg/dl'},
            urea: {valor: '20 - 50', unidad: 'mg/dl'},
            creatinina: {valor: '0,3 - 0,7', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,3 - 0,9', unidad: 'mg/dl'},
            fosforo: {valor: '7,2 - 10,1', unidad: 'mg/dl'},
            calcio: {valor: '9,8 - 12,4', unidad: 'mg/dl'},
            magnesio: {valor: '1,8 - 3,0', unidad: 'mg/dl'},
            sodio: {valor: '144 - 160', unidad: 'mmol/l'},
            potasio: {valor: '4,8 - 6,2', unidad: 'mmol/l'},
            cloro: {valor: '105 - 125', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '12 - 27', unidad: 'mmol/l'},
            na_k: {valor: '27 - 38', unidad: ''}
        },
        'De 0 a 1,5 meses': {
            glucosa: {valor: '97 - 150', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '5,9 - 15,2', unidad: 'mg/dl'},
            urea: {valor: '20 - 50', unidad: 'mg/dl'},
            creatinina: {valor: '0,3 - 0,7', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,4 - 1,4', unidad: 'mg/dl'},
            fosforo: {valor: '7,5 - 10,1', unidad: 'mg/dl'},
            calcio: {valor: '9,8 - 12,4', unidad: 'mg/dl'},
            magnesio: {valor: '1,6 - 2,6', unidad: 'mg/dl'},
            sodio: {valor: '142 - 157', unidad: 'mmol/l'},
            potasio: {valor: '4,8 - 5,8', unidad: 'mmol/l'},
            cloro: {valor: '105 - 125', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '12 - 27', unidad: 'mmol/l'},
            na_k: {valor: '27 - 38', unidad: ''}
        }
    },
    'Hembra': {
        'De 1 año a 20 años': {
            glucosa: {valor: '77 - 126', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '7 - 23', unidad: 'mg/dl'},
            urea: {valor: '20 - 50', unidad: 'mg/dl'},
            creatinina: {valor: '0,6 - 1,2', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,5 - 1,4', unidad: 'mg/dl'},
            fosforo: {valor: '3,3 - 6,4', unidad: 'mg/dl'},
            calcio: {valor: '9,0 - 11,4', unidad: 'mg/dl'},
            magnesio: {valor: '1,8 - 3,0', unidad: 'mg/dl'},
            sodio: {valor: '139 - 164', unidad: 'mmol/l'},
            potasio: {valor: '4,4 - 6,1', unidad: 'mmol/l'},
            cloro: {valor: '105 - 125', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '12 - 27', unidad: 'mmol/l'},
            na_k: {valor: '27 - 38', unidad: ''}
        },
        'De 6 meses a 1 año': {
            glucosa: {valor: '29 - 127', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '10 - 27', unidad: 'mg/dl'},
            urea: {valor: '20 - 50', unidad: 'mg/dl'},
            creatinina: {valor: '0,7 - 1,4', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,4 - 1,6', unidad: 'mg/dl'},
            fosforo: {valor: '4,4 - 9,2', unidad: 'mg/dl'},
            calcio: {valor: '9,4 - 11,7', unidad: 'mg/dl'},
            magnesio: {valor: '1,8 - 3,0', unidad: 'mg/dl'},
            sodio: {valor: '139 - 163', unidad: 'mmol/l'},
            potasio: {valor: '4,3 - 5,5', unidad: 'mmol/l'},
            cloro: {valor: '105 - 125', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '12 - 27', unidad: 'mmol/l'},
            na_k: {valor: '27 - 38', unidad: ''}
        },
        'De 3 meses a 6 meses': {
            glucosa: {valor: '82 - 130', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '7 - 19', unidad: 'mg/dl'},
            urea: {valor: '20 - 50', unidad: 'mg/dl'},
            creatinina: {valor: '0,4 - 0,9', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,3 - 0,9', unidad: 'mg/dl'},
            fosforo: {valor: '7,5 - 10,0', unidad: 'mg/dl'},
            calcio: {valor: '10,1 - 12,3', unidad: 'mg/dl'},
            magnesio: {valor: '1,8 - 3,0', unidad: 'mg/dl'},
            sodio: {valor: '138 - 156', unidad: 'mmol/l'},
            potasio: {valor: '4,3 - 5,9', unidad: 'mmol/l'},
            cloro: {valor: '105 - 125', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '12 - 27', unidad: 'mmol/l'},
            na_k: {valor: '27 - 38', unidad: ''}
        },
        'De 0 a 1,5 meses': {
            glucosa: {valor: '108 - 151', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '6,2 - 15,2', unidad: 'mg/dl'},
            urea: {valor: '20 - 50', unidad: 'mg/dl'},
            creatinina: {valor: '0,3 - 0,8', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,3 - 1,3', unidad: 'mg/dl'},
            fosforo: {valor: '7,5 - 10,7', unidad: 'mg/dl'},
            calcio: {valor: '9,9 - 12,0', unidad: 'mg/dl'},
            magnesio: {valor: '1,8 - 3,0', unidad: 'mg/dl'},
            sodio: {valor: '144 - 159', unidad: 'mmol/l'},
            potasio: {valor: '4,7 - 6,0', unidad: 'mmol/l'},
            cloro: {valor: '105 - 125', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '12 - 27', unidad: 'mmol/l'},
            na_k: {valor: '27 - 38', unidad: ''}
        }
    },
    'Felino Macho': {
        'De 1 año a 20 años': {
            glucosa: {valor: '65 - 111', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '20 - 42', unidad: 'mg/dl'},
            urea: {valor: '30 - 60', unidad: 'mg/dl'},
            creatinina: {valor: '0,5 - 1,8', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,3 - 0,9', unidad: 'mg/dl'},
            fosforo: {valor: '4,1 - 6,4', unidad: 'mg/dl'},
            calcio: {valor: '8,3 - 10,4', unidad: 'mg/dl'},
            magnesio: {valor: '1,9 - 2,28', unidad: 'mg/dl'},
            sodio: {valor: '149 - 163', unidad: 'mmol/l'},
            potasio: {valor: '4,1 - 5,4', unidad: 'mmol/l'},
            cloro: {valor: '114 - 126', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '20 - 25', unidad: 'mmol/l'},
            na_k: {valor: '32 - 41', unidad: ''}
        },
        'De 6 meses a 1 año': {
            glucosa: {valor: '67 - 102', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '14 - 36', unidad: 'mg/dl'},
            urea: {valor: '30 - 60', unidad: 'mg/dl'},
            creatinina: {valor: '0,4- 1,2', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,4 - 1,3', unidad: 'mg/dl'},
            fosforo: {valor: '6,2 - 9,1', unidad: 'mg/dl'},
            calcio: {valor: '8,5 - 10,3', unidad: 'mg/dl'},
            magnesio: {valor: '1,9 - 2,28', unidad: 'mg/dl'},
            sodio: {valor: '152 - 162', unidad: 'mmol/l'},
            potasio: {valor: '4,1 - 5,7', unidad: 'mmol/l'},
            cloro: {valor: '114 - 126', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '20 - 25', unidad: 'mmol/l'},
            na_k: {valor: '32 - 41', unidad: ''}
        },
        'De 3 meses a 6 meses': {
            glucosa: {valor: '61 - 102', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '19 - 34', unidad: 'mg/dl'},
            urea: {valor: '30 - 60', unidad: 'mg/dl'},
            creatinina: {valor: '0,4 - 0,9', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,4 - 1,1', unidad: 'mg/dl'},
            fosforo: {valor: '7,1 - 9,5', unidad: 'mg/dl'},
            calcio: {valor: '9,1 - 10,9', unidad: 'mg/dl'},
            magnesio: {valor: '1,9 - 2,28', unidad: 'mg/dl'},
            sodio: {valor: '143 - 159', unidad: 'mmol/l'},
            potasio: {valor: '4,4 - 5,9', unidad: 'mmol/l'},
            cloro: {valor: '114 - 126', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '20 - 25', unidad: 'mmol/l'},
            na_k: {valor: '32 - 41', unidad: ''}
        }
    },
    'Felino Hembra': {
        'De 1 año a 20 años': {
            glucosa: {valor: '65 - 111', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '19 - 30', unidad: 'mg/dl'},
            urea: {valor: '30 - 60', unidad: 'mg/dl'},
            creatinina: {valor: '0,6 - 1,7', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,5 - 1,4', unidad: 'mg/dl'},
            fosforo: {valor: '3,2 - 6,6', unidad: 'mg/dl'},
            calcio: {valor: '7,8 - 9,2', unidad: 'mg/dl'},
            magnesio: {valor: '1,9 - 2,28', unidad: 'mg/dl'},
            sodio: {valor: '147 - 163', unidad: 'mmol/l'},
            potasio: {valor: '4,0 - 5,0', unidad: 'mmol/l'},
            cloro: {valor: '114 - 126', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '20 - 25', unidad: 'mmol/l'},
            na_k: {valor: '32 - 41', unidad: ''}
        },
        'De 6 meses a 1 año': {
            glucosa: {valor: '19 - 37', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '19 - 34', unidad: 'mg/dl'},
            urea: {valor: '30 - 60', unidad: 'mg/dl'},
            creatinina: {valor: '0,3 - 1,2', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,3 - 1,3', unidad: 'mg/dl'},
            fosforo: {valor: '4,9 - 8,3', unidad: 'mg/dl'},
            calcio: {valor: '8-5 - 10,3', unidad: 'mg/dl'},
            magnesio: {valor: '1,9 - 2,28', unidad: 'mg/dl'},
            sodio: {valor: '147 - 163', unidad: 'mmol/l'},
            potasio: {valor: '4,1 - 5,6', unidad: 'mmol/l'},
            cloro: {valor: '114 - 126', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '20 - 25', unidad: 'mmol/l'},
            na_k: {valor: '32 - 41', unidad: ''}
        },
        'De 3 meses a 6 meses': {
            glucosa: {valor: '59 - 99', unidad: 'mg/dl'},
            nitrogeno_ureico: {valor: '19 - 33', unidad: 'mg/dl'},
            urea: {valor: '30 - 60', unidad: 'mg/dl'},
            creatinina: {valor: '0,4 - 0,9', unidad: 'mg/dl'},
            bun_crea: {valor: '4,2 - 32,8', unidad: 'mg/dl'},
            acido_urico: {valor: '0,4 - 1,2', unidad: 'mg/dl'},
            fosforo: {valor: '6,9 - 9,5', unidad: 'mg/dl'},
            calcio: {valor: '8,9 - 10,9', unidad: 'mg/dl'},
            magnesio: {valor: '1,9 - 2,28', unidad: 'mg/dl'},
            sodio: {valor: '144 - 162', unidad: 'mmol/l'},
            potasio: {valor: '4,1 - 5,5', unidad: 'mmol/l'},
            cloro: {valor: '114 - 126', unidad: 'mmol/l'},
            dioxido_carbono: {valor: '20 - 25', unidad: 'mmol/l'},
            na_k: {valor: '32 - 41', unidad: ''}
        }
    }
};

function formatearRangoConEspacios(valor) {
    // Reemplaza cualquier guion rodeado o no de espacios por ' - '
    return valor.replace(/\s*-\s*/g, ' - ');
}

function actualizarValoresReferencia2() {
    const sexo = document.getElementById('sexoSelector').value;
    const especie = document.getElementById('especieSelector').value;
    const edad = document.getElementById('edadSelector').value;
    let grupoEdad = '';
    if (edad === 'De 1 año a 12 años' || edad === 'De 1 año a 20 años') grupoEdad = 'De 1 año a 20 años';
    else if (edad === 'De 6 meses a 1 año') grupoEdad = 'De 6 meses a 1 año';
    else if (edad === 'De 3 meses a 6 meses') grupoEdad = 'De 3 meses a 6 meses';
    else if (edad === 'De 0 mes a 1,5 meses' || edad === 'De 0 a 1,5 meses') grupoEdad = 'De 0 a 1,5 meses';
    else grupoEdad = 'De 1 año a 20 años';

    // Ajuste para felinos: combinar especie y sexo
    let claveSexo = sexo;
    if (especie === 'Felino' && (sexo === 'Macho' || sexo === 'Hembra')) {
        claveSexo = `Felino ${sexo}`;
    }

    const ref = valoresReferenciaRenal[claveSexo] && valoresReferenciaRenal[claveSexo][grupoEdad];
    if (!ref) return;
    if (ref.glucosa) {
        document.getElementById('refglucosa').textContent = formatearRangoConEspacios(ref.glucosa.valor);
        document.getElementById('refglucosa').nextElementSibling.textContent = ref.glucosa.unidad;
    }
    if (ref.nitrogeno_ureico) {
        document.getElementById('refnitrogeno_ureico').textContent = formatearRangoConEspacios(ref.nitrogeno_ureico.valor);
        document.getElementById('refnitrogeno_ureico').nextElementSibling.textContent = ref.nitrogeno_ureico.unidad;
    }
    if (ref.urea) {
        document.getElementById('refurea').textContent = formatearRangoConEspacios(ref.urea.valor);
        document.getElementById('refurea').nextElementSibling.textContent = ref.urea.unidad;
    }
    if (ref.creatinina) {
        document.getElementById('refcreatinina').textContent = formatearRangoConEspacios(ref.creatinina.valor);
        document.getElementById('refcreatinina').nextElementSibling.textContent = ref.creatinina.unidad;
    }
    if (ref.bun_crea) {
        document.getElementById('refbun_crea').textContent = formatearRangoConEspacios(ref.bun_crea.valor);
        document.getElementById('refbun_crea').nextElementSibling.textContent = ref.bun_crea.unidad;
    }
    if (ref.acido_urico) {
        document.getElementById('refacido_urico').textContent = formatearRangoConEspacios(ref.acido_urico.valor);
        document.getElementById('refacido_urico').nextElementSibling.textContent = ref.acido_urico.unidad;
    }
    if (ref.fosforo) {
        document.getElementById('reffosforo').textContent = formatearRangoConEspacios(ref.fosforo.valor);
        document.getElementById('reffosforo').nextElementSibling.textContent = ref.fosforo.unidad;
    }
    if (ref.calcio) {
        document.getElementById('refcalcio').textContent = formatearRangoConEspacios(ref.calcio.valor);
        document.getElementById('refcalcio').nextElementSibling.textContent = ref.calcio.unidad;
    }
    if (ref.magnesio) {
        document.getElementById('refmagnesio').textContent = formatearRangoConEspacios(ref.magnesio.valor);
        document.getElementById('refmagnesio').nextElementSibling.textContent = ref.magnesio.unidad;
    }
    if (ref.sodio) {
        document.getElementById('refsodio').textContent = formatearRangoConEspacios(ref.sodio.valor);
        document.getElementById('refsodio').nextElementSibling.textContent = ref.sodio.unidad;
    }
    if (ref.potasio) {
        document.getElementById('refpotasio').textContent = formatearRangoConEspacios(ref.potasio.valor);
        document.getElementById('refpotasio').nextElementSibling.textContent = ref.potasio.unidad;
    }
    if (ref.cloro) {
        document.getElementById('refcloro').textContent = formatearRangoConEspacios(ref.cloro.valor);
        document.getElementById('refcloro').nextElementSibling.textContent = ref.cloro.unidad;
    }
    if (ref.dioxido_carbono) {
        document.getElementById('refdioxido_carbono').textContent = formatearRangoConEspacios(ref.dioxido_carbono.valor);
        document.getElementById('refdioxido_carbono').nextElementSibling.textContent = ref.dioxido_carbono.unidad;
    }
    if (ref.na_k) {
        document.getElementById('refna_k').textContent = formatearRangoConEspacios(ref.na_k.valor);
        document.getElementById('refna_k').nextElementSibling.textContent = ref.na_k.unidad;
    }
}
</script>
        <div class="footer">
            <p id="mensajeMedico" style="display: none;">El personal médico cuenta con un plazo de 24 a 48 horas para interpretar el reporte de los resultados.</p>
            <p>Facebook: Veterinaria San Martin de Porres | Teléfono: 4000 - 1365 | Ext: 106</p>
            <p>WhatsApp: 8839 - 2214 | San Rafael Abajo de Desamparados, 50 metros Norte del Mall Zona Centro</p>
            <p>Correo: laboratorio@vetsanmartin.com</p>
        </div>
        </div> 
        <div class="controls no-print">
            <button id="pdfButton" onclick="generatePDF()">Generar PDF</button>
            <button id="menuButton" onclick="window.location.href='index.html'">Volver al Menú</button>
            <div id="loadingPdf" class="loading-indicator" style="display:none;">
                <div class="spinner"></div>
                <span>Generando PDF...</span>
            </div>
        </div>
        
        <div class="parameter-selector-panel no-print">
            <h3>Eliminar parámetros</h3>
            <div class="selector-container">
                <select id="parameterSelector" class="parameter-dropdown">
                    <option value="" selected disabled>-- Seleccionar parámetro --</option>
                </select>
                <button onclick="eliminarParametroSeleccionado()" class="remove-param-btn">Eliminar</button>
            </div>
        </div>
        <script>
        // Funciones para eliminar y restaurar campos
        document.addEventListener('DOMContentLoaded', () => {
            cargarListaDeParametros();
            console.log("Cargando lista de parámetros del perfil renal..."); // Para debugear
        });

        function cargarListaDeParametros() {
            const selector = document.getElementById('parameterSelector');
            if (!selector) {
                console.error("No se encontró el selector de parámetros");
                return;
            }
            
            selector.innerHTML = '<option value="" selected disabled>-- Seleccionar parámetro --</option>';
            
            // Lista de parámetros específicos del perfil renal
            const parametrosEspecificos = [
                "Glucosa", "Nitrógeno Ureico", "Urea", "Creatinina", "Relación BUN/Crea",
                "Ácido Úrico", "Fósforo", "Calcio", "Magnesio", "Sodio", "Potasio", 
                "Cloro", "Dióxido de Carbono", "NA+/K+"
            ];
            
            const tablas = document.querySelectorAll('#template1 table');
            console.log(`Encontradas ${tablas.length} tablas`); // Para debugear
            
            tablas.forEach((tabla, tablaIndex) => {
                const filas = tabla.querySelectorAll('tbody tr.field-row');
                console.log(`Tabla ${tablaIndex}: ${filas.length} filas`); // Para debugear
                
                filas.forEach((fila, filaIndex) => {
                    if (!fila.cells || fila.cells.length === 0) return;
                    
                    // Obtener el nombre del parámetro (primera celda, sin el botón)
                    const primeraCelda = fila.cells[0];
                    const paramName = primeraCelda.textContent.replace('×', '').trim();
                    console.log(`Fila ${filaIndex}: "${paramName}"`); // Para debugear
                    
                    // Solo agregar los parámetros específicos que queremos
                    if (parametrosEspecificos.includes(paramName)) {
                        const option = document.createElement('option');
                        option.value = fila.id;
                        option.textContent = paramName;
                        selector.appendChild(option);
                    }
                });
            });
            
            console.log(`Total de opciones cargadas: ${selector.options.length - 1}`); // Para debugear
        }

        function eliminarParametroSeleccionado() {
            const selector = document.getElementById('parameterSelector');
            const filaId = selector.value;
            
            if (!filaId) {
                alert('Por favor, selecciona un parámetro para eliminar.');
                return;
            }
            
            const fila = document.getElementById(filaId);
            if (fila) {
                fila.remove();
                
                // Actualizar el selector después de eliminar
                cargarListaDeParametros();
            }
        }

        // Funciones para eliminar y restaurar campos individuales (solo desde el selector)
        function deleteField(rowId, fieldName) {
            const row = document.getElementById(rowId);
            if (row) {
                row.style.display = 'none';
                row.classList.add('deleted');
                
                // Agregar al área de restauración
                const restoreArea = document.getElementById('deletedFields');
                const restoreControls = document.getElementById('restoreControls');
                
                if (restoreArea && restoreControls) {
                    const button = document.createElement('button');
                    button.className = 'restore-btn';
                    button.textContent = fieldName;
                    button.onclick = () => restoreField(rowId, button);
                    restoreArea.appendChild(button);
                    
                    restoreControls.style.display = 'block';
                }
                
                // Actualizar la lista del selector
                cargarListaDeParametros();
            }
        }

        function restoreField(rowId, button) {
            const row = document.getElementById(rowId);
            if (row) {
                row.style.display = '';
                row.classList.remove('deleted');
                button.remove();
                
                // Ocultar controles de restauración si no hay más campos eliminados
                const restoreArea = document.getElementById('deletedFields');
                const restoreControls = document.getElementById('restoreControls');
                
                if (restoreArea && restoreArea.children.length === 0 && restoreControls) {
                    restoreControls.style.display = 'none';
                }
                
                // Actualizar la lista del selector
                cargarListaDeParametros();
            }
        }

        function restoreAllFields() {
            const deletedRows = document.querySelectorAll('.field-row.deleted');
            deletedRows.forEach(row => {
                row.style.display = '';
                row.classList.remove('deleted');
            });
            
            // Limpiar área de restauración
            const restoreArea = document.getElementById('deletedFields');
            const restoreControls = document.getElementById('restoreControls');
            
            if (restoreArea) {
                restoreArea.innerHTML = '';
            }
            
            if (restoreControls) {
                restoreControls.style.display = 'none';
            }
            
            // Actualizar la lista del selector
            cargarListaDeParametros();
        }
        
        async function generatePDF() {
    const loadingIndicator = document.getElementById('loadingPdf');
    const pdfButton = document.getElementById('pdfButton');
    
    loadingIndicator.style.display = 'flex';
    pdfButton.disabled = true;
    
    try {
        const { jsPDF } = window.jspdf;
        const selectedTemplate = document.getElementById('template1');

        if (!selectedTemplate) {
            alert('No se encontró la plantilla.');
            return;
        }

        // Obtener el nombre de la mascota y el apellido del propietario
        const mascotaNombre = document.getElementById('mascotaNombre').value || 'Sin_nombre';
        const propietarioNombre = document.getElementById('propietarioNombre').value || 'Sin_apellido';
        
        // Separar el nombre completo para obtener el apellido
        const nombreArray = propietarioNombre.split(' ');
        const propietarioApellido = nombreArray.length > 1 ? nombreArray[1] : nombreArray[0];

        // Esperar a que todas las imágenes dentro del elemento se carguen
        const images = selectedTemplate.getElementsByTagName('img');
        const loadImages = Array.from(images).map(img => {
            return new Promise((resolve, reject) => {
                if (img.complete) {
                    resolve();
                } else {
                    img.onload = resolve;
                    img.onerror = reject;
                }
            });
        });

        await Promise.all(loadImages);

        // Capturar la plantilla como imagen
        const canvas = await html2canvas(selectedTemplate, {
            scale: 2,
            useCORS: true,
            backgroundColor: '#ffffff'
        });

        const imgData = canvas.toDataURL('image/jpeg', 1.0);
        const pdf = new jsPDF('p', 'mm', 'a4');
        const imgWidth = 150; 
        const pageHeight = 297;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        // Calcular la posición para centrar la imagen con márgenes
        const x = (pdf.internal.pageSize.getWidth() - imgWidth) / 2;
        const y = 5;

        // Agrega la imagen de la plantilla escalada y centrada
        pdf.addImage(imgData, 'JPEG', x, y, imgWidth, imgHeight);

        // Genera el nombre del archivo según la plantilla actual y datos
        const fileName = `Perfil Renal ${mascotaNombre} ${propietarioApellido}.pdf`;

        // Guarda el PDF
        pdf.save(fileName);
    } catch (error) {
        console.error('Error al generar el PDF:', error);
        alert('Ocurrió un error al generar el PDF: ' + error.message);
    } finally {
        // Ocultar el indicador de carga y habilitar el botón nuevamente
        loadingIndicator.style.display = 'none';
        pdfButton.disabled = false;
    }
}
</script>
</body>
</html>