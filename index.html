<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Consultas - Veterinaria</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="css/laboratorio.css">
  <link rel="stylesheet" href="css/consentimientos.css">
  <link rel="stylesheet" href="css/quirofano.css">
  <link rel="stylesheet" href="css/internamiento.css">
  
  <link rel="icon" href="img/empresa.jpg" type="image/x-icon">
</head>
<body>
  <!-- Botón menú hamburguesa para dispositivos móviles -->
<button id="menuToggle" class="menu-toggle" title="Mostrar/Ocultar menú" style="display:none;">
  <i class="fas fa-bars"></i>
</button>
  <!-- Botón para ocultar sidebar (todos los usuarios excepto recepción) -->
  <button id="menuToggleBtn" class="menu-toggle" style="display:none;">
    <i class="fas fa-angle-double-left"></i> 
  </button>
  <div class="main-container">
    <!-- Overlay para cerrar sidebar en móviles -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>
    
    <!-- Sidebar con navegación -->
    <aside class="sidebar">
      <!-- Botón de cierre para móviles -->
      <button class="sidebar-close-btn" onclick="closeSidebar()">
        <i class="fas fa-times"></i>
      </button>
      
      <div class="logo">
        <img src="img/empresa.jpg" alt="Logo Veterinaria">
        <h1>Veterinaria San Martin de Porres</h1>
      </div>
      
      <!-- Añadir información del usuario -->
      <div class="user-info">
        <div class="user-avatar">
          <i class="fas fa-user-circle"></i>
        </div>
        <div class="user-details">
          <p id="userName">Usuario</p>
          <span id="userRole">Rol</span>  
        </div>
      </div>
      
      <nav>
        <!-- Consultas -->
        <div class="nav-category">
          <button id="consultasBtn" class="nav-category-btn" onclick="toggleSubmenuHTML('consultasBtn', 'consultasSubmenu');">
            <i class="fas fa-stethoscope"></i> Consultas
            <i class="fas fa-chevron-down category-arrow"></i>
          </button>
          <div id="consultasSubmenu" class="nav-submenu">
            <button id="crearTicketBtn" class="submenu-btn" onclick="navigateToSection('crearTicketSection', 'crearTicketBtn');">
              <i class="fas fa-plus-circle"></i> Crear Consulta
            </button>
            <button id="verTicketsBtn" class="submenu-btn" onclick="navigateToConsultas();">
              <i class="fas fa-list-alt"></i> Ver Consultas
            </button>
            <button id="vacunasBtn" class="submenu-btn" onclick="navigateToVacunas('vacunasSection', 'vacunasBtn');">
              <i class="fas fa-syringe"></i> Control de Vacunas
            </button>
          </div>
        </div>

        <!-- Consentimientos -->
        <div class="nav-category">
          <button id="consentimientosBtn" class="nav-category-btn" onclick="toggleSubmenuHTML('consentimientosBtn', 'consentimientosSubmenu');">
            <i class="fas fa-file-contract"></i> Consentimientos
            <i class="fas fa-chevron-down category-arrow"></i>
          </button>
          <div id="consentimientosSubmenu" class="nav-submenu">
            <button id="crearConsentimientoBtn" class="submenu-btn" onclick="navigateToSection('consentimientosSection', 'crearConsentimientoBtn');">
              <i class="fas fa-file-plus"></i> Crear Consentimiento
            </button>
          </div>
        </div>

        <!-- Laboratorio -->
        <div class="nav-category">
          <button id="laboratorioBtn" class="nav-category-btn" onclick="toggleSubmenuHTML('laboratorioBtn', 'laboratorioSubmenu');">
            <i class="fas fa-microscope"></i> Laboratorio
            <i class="fas fa-chevron-down category-arrow"></i>
          </button>
          <div id="laboratorioSubmenu" class="nav-submenu">
            <button id="crearLabBtn" class="submenu-btn" onclick="navigateToLab('crearLabSection', 'crearLabBtn');">
              <i class="fas fa-vials"></i> Crear Ticket Lab
            </button>
            <button id="verLabBtn" class="submenu-btn" onclick="navigateToLab('verLabSection', 'verLabBtn');">
              <i class="fas fa-microscope"></i> Ver Tickets Lab
            </button>
            <button id="reportesLabBtn" class="submenu-btn" onclick="navigateToLab('reportesLabSection', 'reportesLabBtn');">
              <i class="fas fa-file-medical"></i> Reportes Lab
            </button>
            <button id="inyectablesBtn" class="submenu-btn" onclick="navigateToInyectables('inyectablesSection', 'inyectablesBtn');">
              <i class="fas fa-syringe"></i> Control de Inyectables
            </button>

          </div>
        </div>

        <!-- Quirófano -->
        <div class="nav-category">
          <button id="quirofanoBtn" class="nav-category-btn" onclick="toggleSubmenuHTML('quirofanoBtn', 'quirofanoSubmenu');">
            <i class="fas fa-cut"></i> Quirófano
            <i class="fas fa-chevron-down category-arrow"></i>
          </button>
          <div id="quirofanoSubmenu" class="nav-submenu">
            <button id="crearQuirofanoBtn" class="submenu-btn" onclick="navigateToQuirofano('crearQuirofanoSection', 'crearQuirofanoBtn');">
              <i class="fas fa-plus-circle"></i> Crear Ticket
            </button>
            <button id="verQuirofanoBtn" class="submenu-btn" onclick="navigateToQuirofano('verQuirofanoSection', 'verQuirofanoBtn');">
              <i class="fas fa-list-alt"></i> Ver Tickets
            </button>
          </div>
        </div>

        <!-- Internamiento -->
        <div class="nav-category">
          <button id="internamientoBtn" class="nav-category-btn" onclick="toggleSubmenuHTML('internamientoBtn', 'internamientoSubmenu');">
            <i class="fas fa-home"></i> Internamiento
            <i class="fas fa-chevron-down category-arrow"></i>
          </button>
          <div id="internamientoSubmenu" class="nav-submenu">
            <button id="crearInternamientoBtn" class="submenu-btn" onclick="navigateToInternamiento('crearInternamientoSection', 'crearInternamientoBtn');">
              <i class="fas fa-plus-circle"></i> Registrar Paciente
            </button>
            <button id="verInternamientoBtn" class="submenu-btn" onclick="navigateToInternamiento('verInternamientoSection', 'verInternamientoBtn');">
              <i class="fas fa-list-alt"></i> Ver Pacientes
            </button>
            <button id="monitoreoInternamientoBtn" class="submenu-btn" onclick="navigateToInternamiento('monitoreoInternamientoSection', 'monitoreoInternamientoBtn');">
              <i class="fas fa-heartbeat"></i> Monitoreo
            </button>
            <button id="medicamentosInternamientoBtn" class="submenu-btn" onclick="navigateToInternamiento('medicamentosInternamientoSection', 'medicamentosInternamientoBtn');">
              <i class="fas fa-pills"></i> Medicamentos
            </button>
          </div>
        </div>

      
        <!-- Administrativo (solo para admin) -->
        <div id="administrativoCategory" class="nav-category admin-only" style="display: none;">
          <button id="administrativoBtn" class="nav-category-btn" onclick="toggleSubmenuHTML('administrativoBtn', 'administrativoSubmenu');">
            <i class="fas fa-cogs"></i> Administrativo
            <i class="fas fa-chevron-down category-arrow"></i>
          </button>
          <div id="administrativoSubmenu" class="nav-submenu">
            <button id="horarioBtn" class="submenu-btn" onclick="navigateToSection('horarioSection', 'horarioBtn');">
              <i class="fas fa-calendar-alt"></i> Horario
            </button>
            <button id="estadisticasBtn" class="submenu-btn" onclick="navigateToEstadisticas();">
              <i class="fas fa-chart-pie"></i> Estadísticas
            </button>
          </div>
        </div>
      </nav>
      
      <!-- Añadir botón de cerrar sesión -->
      <button id="logoutBtn" class="btn-logout"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</button>

      <!-- Botón solo para admin -->
      <button id="adminUsersBtn" class="admin-btn" style="display:none; margin-top:10px;"><i class="fas fa-users-cog"></i> Administrar usuarios</button>
      <div class="sidebar-footer">
        <p>© 2025 Veterinaria SMP</p>
      </div>
    </aside>

    <!-- Contenido principal -->
    <div class="content" id="mainContent">
      <!-- Sección para crear tickets -->
      <section id="crearTicketSection" class="hidden">
        <h2><i class="fas fa-paw"></i> Crear Consulta</h2>
        <div class="form-container">
          <form id="ticketForm">
            <div class="form-row">
              <div class="form-group">
                <label for="nombre">Nombre del Cliente</label>
                <input type="text" id="nombre" required>
              </div>
              <div class="form-group">
                <label for="cedula">Cédula</label>
                <input type="text" id="cedula" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="mascota">Nombre de la Mascota</label>
                <input type="text" id="mascota" required>
              </div>
              <div class="form-group">
                <label for="tipoMascota">Tipo de Mascota</label>
                <select id="tipoMascota" required>
                  <option value="perro">Perro</option>
                  <option value="gato">Gato</option>
                  <option value="conejo">Conejo</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="idPaciente">Número ID del paciente</label>
                <input type="text" id="idPaciente" placeholder="ID del paciente" required>
              </div>
              <div class="form-group">
                <label for="fecha">Fecha de Consulta</label>
                <input type="date" id="fecha" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="hora">Hora de Consulta</label>
                <input type="time" id="hora">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="doctorAtiende"><i class="fas fa-user-md"></i> Doctor que atiende</label>
                <select id="doctorAtiende" name="doctorAtiende">
                  <option value="">Seleccione un doctor</option>
                  <option value="Dr. Luis Coto">Dr. Luis Coto</option>
                  <option value="Dr. Randall Azofeifa">Dr. Randall Azofeifa</option>
                  <option value="Dr. Gustavo Gonzalez">Dr. Gustavo Gonzalez</option>
                  <option value="Dra. Daniela Sancho">Dra. Daniela Sancho</option>
                  <option value="Dra. Francinny Nuñez">Dra. Francinny Nuñez</option>
                  <option value="Dra. Kharen Moreno">Dra. Kharen Moreno</option>
                  <option value="Dra. Karina Madrigal">Dra. Karina Madrigal</option>
                  <option value="Dra. Lourdes Chacón">Dra. Lourdes Chacón</option>
                  <option value="Dra. Karla Quesada">Dra. Karla Quesada</option>
                  <option value="Dra. Natalia Alvarado">Dra. Natalia Alvarado</option>
                  <option value="Dra. Nicole Sibaja">Dra. Nicole Sibaja</option>

                </select>
              </div>
              <div class="form-group">
                <label for="asistenteAtiende"><i class="fas fa-user-nurse"></i> Asistente que atiende</label>
                <select id="asistenteAtiende" name="asistenteAtiende">
                  <option value="">Seleccione un asistente</option>
                  <option value="Tec. Maribel Guzmán">Tec. Maribel Guzmán</option>
                  <option value="Tec. Juliana Perez">Tec. Juliana Perez</option>
                  <option value="Tec. Jafeth Bermudez">Tec. Jafeth Bermudez</option>
                  <option value="Tec. Gabriela Zuñiga">Tec. Gabriela Zuñiga</option>
                  <option value="Tec. Indra Perez">Tec. Indra Perez</option>
                  <option value="Tec. Randy Arias">Tec. Randy Arias</option>
                  <option value="Tec. Yancy Picado">Tec. Yancy Picado</option>
                  <option value="Tec. Maria Fernanda">Tec. Maria Fernanda</option>
                  <option value="Tec. Nicole Gamboa">Tec. Nicole Gamboa</option>
                  <option value="Tec. Paola López">Tec. Paola López</option>
                  <option value="Tec. Alexander Ureña">Tec. Alexander Ureña</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="estado">Estado</label>
                <select id="estado" required>
                  <option value="espera">En Sala de Espera</option>
                  <option value="consultorio1">Consultorio 1</option>
                  <option value="consultorio2">Consultorio 2</option>
                  <option value="consultorio3">Consultorio 3</option>
                  <option value="consultorio4">Consultorio 4</option>
                  <option value="consultorio5">Consultorio 5</option>
                  <option value="rayosx">En Rayos X</option>
                  <option value="quirofano">En Quirófano</option>
                  <option value="terminado">Consulta Terminada</option>
                </select>
              </div>
              <div class="form-group">
                <label for="urgencia">Categorización de pacientes</label>
                <select id="urgencia" required>
                  <option value="consulta" selected>🔵 Consulta Regular</option>
                  <option value="prequirurgico">🟣 Exámenes Pre Quirúrgicos</option>
                  <option value="emergencia">🔴 Emergencias</option>
                  <option value="urgencia">🟠 Urgencias</option>
                  <option value="leve">🟢 Leve</option>
                </select>
                <div id="urgenciaDesc" style="font-size:0.95em;color:#1976d2;margin-top:4px;"></div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="tipoServicio">Tipo de Servicio</label>
                <select id="tipoServicio" required>
                  <option value="consulta">Consulta general</option>
                  <option value="revaloracion">Revaloración</option>
                  <option value="retiroHilos">Retiro de hilos</option>
                  <option value="rayosX">Rayos X</option>
                  <option value="desparasitacion">Desparasitación</option>
                  <option value="inyectable">Inyectables</option>
                  <option value="vacunas">Vacunas</option>
                  <option value="consulta_8pm">Consulta después de las 8 P.M</option>
                  <option value="consulta_6pm">Consulta después de las 6 P.M</option>
                  <option value="hmg_limpieza">HMG Limpieza</option>
                  <option value="hmg_castracion">HMG Castración</option>
                  <option value="cambio_vendaje">Cambio de vendaje</option>
                  <option value="convenia_cx">Convenia de CX</option>
                  <option value="analito">Analito</option>
                  <option value="panel_general_basico">Panel General Básico</option>
                  <option value="panel_plus">Panel Plus</option>
                  <option value="perfil_quimico_general">Perfil quimico general</option>
                  <option value="perfil_pre_quirurgico">Perfil pre quirurgico</option>
                  <option value="perfil_renal">Perfil renal</option>
                  <option value="cirugia">Cirugía</option>
                  <option value="muestra_test">Muestra para test</option>
                  <option value="tiempos_coagulacion">Tiempos de coagulación</option>
                  <option value="internamiento">Internamiento</option>
                  <option value="test_sida_leucemia">Test de Sida Leucemia</option>
                  <option value="test_distemper">Test de Distemper</option>
                  <option value="test_parvovirus">Test Parvovirus</option>
                  <option value="rx_control">RX de Control</option>
                  <option value="corteUnas">Corte de uñas</option>
                  <option value="emergencia">Emergencia</option>
                  <option value="tomaMuestras">Toma de muestras</option>
                  <option value="tests">Tests</option>
                  <option value="hemograma">Hemograma</option>
                  <option value="eutanasia">Eutanasia</option>
                  <option value="quitarPuntos">Quitar puntos</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
              <div class="form-group">
                <label for="numFactura">Número de factura</label>
                <input type="text" id="numFactura" placeholder="Número de factura">
              </div>
            </div>

            <div class="form-group">
              <label for="motivoLlegada">Motivo de Llegada</label>
              <textarea id="motivoLlegada" placeholder="Describa el motivo de llegada" required></textarea>
            </div>
            <div class="form-group">
              <label for="motivo">Motivo de Consulta</label>
              <textarea id="motivo" placeholder="Describa el motivo de la consulta"></textarea>
            </div>
            <div class="form-group">
              <label for="porCobrar">Por Cobrar</label>
              <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 4px; padding: 6px; margin-bottom: 6px; font-size: 12px; color: #1976d2;">
                <i class="fas fa-info-circle" style="margin-right: 4px;"></i>
                Esta información se preservará y acumulará durante las ediciones del ticket.
              </div>
              <textarea id="porCobrar" 
                placeholder="Introduzca información sobre cobros, procedimientos adicionales, medicamentos, etc." 
                style="width: 100%; 
                       min-height: 120px; 
                       resize: vertical; 
                       font-size: 14px; 
                       line-height: 1.5;
                       padding: 12px;
                       white-space: pre-wrap;
                       word-wrap: break-word;"></textarea>
            </div>
            <div class="form-group expediente-field" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
              <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #2c3e50;">
                <input type="checkbox" id="expediente" style="width: 18px; height: 18px; cursor: pointer;">
                <i class="fas fa-clipboard-list" style="color: #27ae60;"></i>
                Paciente ingresado al expediente médico
              </label>
              <small style="display: block; margin-top: 5px; color: #7f8c8d; font-style: italic;">
                Marcar cuando el paciente haya sido registrado en Argus
              </small>
            </div>
            <button type="submit" class="btn-submit"><i class="fas fa-ticket-alt"></i> Agregar Consulta</button>
          </form>
        </div>
      </section>

      <!-- Sección para visualizar tickets -->
      <section id="verTicketsSection" class="hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h2><i class="fas fa-list"></i> Sala de Espera</h2>
          
          <!-- Contador de tickets con exámenes prequirúrgicos -->
          <div id="prequirurgicoCounter" class="prequirurgico-counter" style="display: none;">
            <i class="fas fa-vials"></i>
            <span class="counter-text">Exámenes prequirúrgicos pendientes:</span>
            <span id="prequirurgicoCount" class="counter-number">0</span>
          </div>
        </div>
        
        <!-- Barra de búsqueda (visible para todos menos visitas) -->
        <div id="searchBarContainer" class="search-bar" style="display:none; margin-bottom: 15px;">
          <input type="text" id="ticketSearchInput" placeholder="Buscar por cliente, mascota, ID paciente o factura..." autocomplete="off">
        </div>
        
        <!-- nuevo filtro de fecha -->
        <div id="dateFilterContainer" class="date-filter hidden">
          <label for="filterDate"><i class="fas fa-calendar-alt"></i> Seleccionar fecha:</label>
          <input type="date" id="filterDate">
        </div>

        <div class="filter-container">
          <button class="filter-btn active" data-filter="todos">Todos</button>
          <button class="filter-btn" data-filter="espera">En Espera</button>
          <button class="filter-btn" data-filter="consultorio">En Consultorio</button>
          <button class="filter-btn" data-filter="terminado">Terminados</button>
          <button class="filter-btn" data-filter="porFacturar">Por Facturar</button>
        </div>
        
        <div id="ticketContainer" class="ticket-container"></div>
      </section>
      
      <!-- Sección para crear tickets de laboratorio -->
      <section id="crearLabSection" class="hidden">
        <h2><i class="fas fa-vials"></i> Crear Ticket de Laboratorio</h2>
        <div class="form-container">
          <form id="labTicketForm">
            <!-- Búsqueda de Cliente -->
            <div class="form-row">
              <div class="form-group" style="position: relative;">
                <label for="labClienteSearch">Buscar Cliente</label>
                <input type="text" id="labClienteSearch" placeholder="Escriba nombre, cédula o ID del paciente..." autocomplete="off">
                <div id="labClienteResults" class="cliente-search-results"></div>
              </div>
              <div class="form-group">
                <label for="labFechaFiltro"><i class="fas fa-calendar-alt"></i> Filtrar por Fecha de Consulta</label>
                <input type="date" id="labFechaFiltro" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labNombre">Nombre del Cliente</label>
                <input type="text" id="labNombre" required>
              </div>
              <div class="form-group">
                <label for="labCedula">Cédula</label>
                <input type="text" id="labCedula" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labMascota">Nombre de la Mascota</label>
                <input type="text" id="labMascota" required>
              </div>
              <div class="form-group">
                <label for="labTipoMascota">Tipo de Mascota</label>
                <select id="labTipoMascota" required>
                  <option value="perro">Perro</option>
                  <option value="gato">Gato</option>
                  <option value="conejo">Conejo</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
            </div>

            <!-- Nueva fila para Edad, Raza, Peso y Sexo -->
            <div class="form-row">
              <div class="form-group">
                <label for="labEdad">Edad</label> 
                <input type="text" id="labEdad" placeholder="Ej: 2 años, 6 meses" required> 
              </div>
              <div class="form-group">
                <label for="labRaza">Raza</label>
                <select id="labRaza" required>
                  <option value="">Seleccione primero el tipo de mascota</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labPeso">Peso</label>
                <input type="text" id="labPeso" placeholder="Ej: 5.2 kg, 3 libras" required>
              </div>
              <div class="form-group">
                <label for="labSexo">Sexo</label>
                <select id="labSexo" required>
                  <option value="">Seleccionar</option>
                  <option value="macho">Macho</option>
                  <option value="hembra">Hembra</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labIdPaciente">Número ID del paciente</label>
                <input type="text" id="labIdPaciente" placeholder="ID del paciente" required>
              </div>
              <div class="form-group">
                <label for="labFecha">Fecha de Servicio</label>
                <input type="date" id="labFecha" required>
              </div>
            </div>

            <!-- Sección de Servicios de Laboratorio -->
            <div class="form-group full-width">
              <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #2c3e50; margin-bottom: 15px;">
                <i class="fas fa-vials"></i>
                Servicios de Laboratorio a Realizar
              </label>
              
              <!-- Filtro por categoría -->
              <div class="services-filter" style="margin-bottom: 15px;">
                <label for="categoryFilter" style="font-weight: normal; margin-right: 10px;">Filtrar por categoría:</label>
                <select id="categoryFilter" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                  <option value="">Todos los servicios</option>
                </select>
              </div>

              <!-- Buscador de servicios -->
              <div class="services-search" style="position: relative; margin-bottom: 15px;">
                <input type="text" id="servicesSearch" placeholder="Buscar servicios por nombre..." 
                       style="width: 100%; padding: 10px 40px 10px 12px; border: 1px solid #ddd; border-radius: 4px;">
                <i class="fas fa-search" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #999;"></i>
              </div>

              <!-- Lista de servicios disponibles -->
              <div class="services-container" style="max-height: 400px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px; background: #f9f9f9;">
                <div id="servicesList" class="services-list">
                  <!-- Los servicios se cargarán aquí dinámicamente -->
                </div>
              </div>

              <!-- Servicios seleccionados -->
              <div class="selected-services" style="margin-top: 15px;">
                <h4 style="margin-bottom: 10px; color: #2c3e50;">
                  <i class="fas fa-check-circle" style="color: #42a5f5;"></i>
                  Servicios Seleccionados
                </h4>
                <div id="selectedServicesList" class="selected-services-list" style="min-height: 60px; border: 1px solid #e0e0e0; border-radius: 4px; padding: 10px; background: white;">
                  <p style="color: #999; text-align: center; margin: 20px 0;">No hay servicios seleccionados</p>
                </div>
                <div class="total-price" style="margin-top: 10px; text-align: right;">
                  <span style="font-weight: bold; font-size: 1.1em; color: #2c3e50;">
                    Total: <span id="totalPrice">₡0</span>
                  </span>
                </div>
                <!-- Nota sobre precios -->
                <div class="price-disclaimer" style="margin-top: 10px; padding: 8px 12px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; font-size: 0.85em; color: #856404; text-align: center;">
                  <i class="fas fa-exclamation-triangle" style="margin-right: 5px; color: #f39c12;"></i>
                  <strong>Nota:</strong> Los precios de servicios pueden ser no exactos, consultar siempre en sistema.
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labPrioridad">Prioridad</label>
                <select id="labPrioridad" required>
                  <option value="rutina">🟢 Normal</option>
                  <option value="urgente">🟠 Urgente</option>
                  <option value="emergencia">🔴 Emergencia</option>
                </select>
              </div>
              <div class="form-group">
                <!-- Espacio para balance de layout -->
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labMedicoSolicita"><i class="fas fa-user-md"></i> Médico que Solicita</label>
                <select id="labMedicoSolicita" name="labMedicoSolicita" required>
                  <option value="">Seleccione un médico</option>
                  <option value="Dr. Luis Coto">Dr. Luis Coto</option>
                  <option value="Dr. Randall Azofeifa">Dr. Randall Azofeifa</option>
                  <option value="Dr. Gustavo Gonzalez">Dr. Gustavo Gonzalez</option>
                  <option value="Dra. Daniela Sancho">Dra. Daniela Sancho</option>
                  <option value="Dra. Francinny Nuñez">Dra. Francinny Nuñez</option>
                  <option value="Dra. Kharen Moreno">Dra. Kharen Moreno</option>
                  <option value="Dra. Karina Madrigal">Dra. Karina Madrigal</option>
                  <option value="Dra. Lourdes Chacón">Dra. Lourdes Chacón</option>
                  <option value="Dra. Karla Quesada">Dra. Karla Quesada</option>
                  <option value="Dra. Natalia Alvarado">Dra. Natalia Alvarado</option>
                  <option value="Dra. Nicole Sibaja">Dra. Nicole Sibaja</option>
                  <option value="Medico Externo">Médico Externo</option>

                  <option value="N.A">N.A</option>
                </select>
              </div>
              <div class="form-group">
                <label for="labExamenRegalia" style="display: flex; align-items: center; gap: 8px;">
                  Examen de Regalía
                </label>
                <select id="labExamenRegalia" required>
                  <option value="no">No</option>
                  <option value="si">Sí</option>
                </select>
                <small style="color: #7f8c8d; font-style: italic; display: block; margin-top: 5px;">
                  Firme aquí si es necesario realizar un examen de regalía.
                </small>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labObservaciones">Observaciones</label>
                <textarea id="labObservaciones" placeholder="Observaciones adicionales, síntomas, etc." rows="3"></textarea>
              </div>
            </div>

            <!-- Nueva fila para notas de laboratorio y paquete -->
            <div class="form-row">
              <div class="form-group">
                <label for="labNotasLaboratorio">Notas de Laboratorio</label>
                <textarea id="labNotasLaboratorio" placeholder="Notas específicas del laboratorio, instrucciones, resultados preliminares..." rows="3"></textarea>
              </div>
              <div class="form-group">
                <label for="labPaquete">Tipo de Paquete</label>
                <select id="labPaquete" required>
                  <option value="no_aplica">No Aplica</option>
                  <option value="castracion">Paquete de Castración</option>
                  <option value="limpieza">Paquete de Limpieza</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labEstado">Estado del Ticket</label>
                <select id="labEstado" required>
                  <option value="pendiente">Pendiente</option>
                  <option value="procesando">En proceso</option>
                  <option value="reportado">Reportado por Lab</option>
                  <option value="reportado_cliente">Reportado al Cliente</option>
                  <option value="cliente_no_contesta">Cliente no contesta</option>
                </select>
              </div>
              <div class="form-group">
                <label for="labCorreo">Correo Electrónico</label>
                <input type="text" id="labCorreo" placeholder="Ejemplo: correo@ejemplo.com o cualquier texto" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labTelefono">Teléfono de Contacto</label>
                <input type="tel" id="labTelefono" placeholder="Número de teléfono" required>
              </div>
              <div class="form-group">
                <label for="labFactura">Número de Factura</label>
                <input type="text" id="labFactura" placeholder="Número de factura">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="labDepartamento">Departamento que Solicita</label>
                <select id="labDepartamento" required>
                  <option value="consulta_externa">Consulta Externa</option>
                  <option value="internos">Internos</option>
                </select>
              </div>
              <div class="form-group">
                <!-- Empty group for layout balance -->
              </div>
            </div>

            <button type="submit" class="btn-submit"><i class="fas fa-vials"></i> Crear Ticket de Laboratorio</button>
          </form>
        </div>
      </section>

      <!-- Sección para visualizar tickets de laboratorio -->
      <section id="verLabSection" class="hidden">
        <h2><i class="fas fa-microscope"></i> Tickets de Laboratorio</h2>
        
        <!-- Barra de búsqueda para laboratorio -->
        <div class="search-bar" style="margin-bottom: 15px;">
          <input type="text" id="labSearchInput" placeholder="Buscar por cliente, mascota, ID paciente o tipo de examen..." autocomplete="off">
        </div>
        
        <!-- Estadísticas del Laboratorio -->
        <div class="lab-stats-container">
          <h3><i class="fas fa-chart-bar"></i> Estadísticas del Laboratorio</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <i class="fas fa-vials stat-icon"></i>
              <div class="stat-number" id="totalLabTickets">0</div>
              <div class="stat-label">Total Tickets</div>
            </div>
            <div class="stat-card">
              <i class="fas fa-clock stat-icon"></i>
              <div class="stat-number" id="pendientesLab">0</div>
              <div class="stat-label">Pendientes</div>
            </div>
            <div class="stat-card">
              <i class="fas fa-cogs stat-icon"></i>
              <div class="stat-number" id="procesandoLab">0</div>
              <div class="stat-label">En Proceso</div>
            </div>
            <div class="stat-card">
              <i class="fas fa-check-circle stat-icon"></i>
              <div class="stat-number" id="reportadosLab">0</div>
              <div class="stat-label">Reportados por lab</div>
            </div>
            <div class="stat-card">
              <i class="fas fa-phone stat-icon"></i>
              <div class="stat-number" id="reportadosClienteLab">0</div>
              <div class="stat-label">Reportados al Cliente</div>
            </div>
            <div class="stat-card">
              <i class="fas fa-phone-slash stat-icon"></i>
              <div class="stat-number" id="clienteNoContestaLab">0</div>
              <div class="stat-label">Cliente No Contesta</div>
            </div>
            <div class="stat-card">
              <i class="fas fa-hospital stat-icon"></i>
              <div class="stat-number" id="internosLab">0</div>
              <div class="stat-label">Internos</div>
            </div>
          </div>
        </div>
        
        
        
        <!-- Filtro de fecha para laboratorio -->
        <div class="date-filter" style="margin-bottom: 15px;" id="labDateFilterContainer">
          <label for="labFilterDate"><i class="fas fa-calendar-alt"></i> Seleccionar fecha:</label>
          <input type="date" id="labFilterDate">
        </div>

        <!-- Filtro por médico para laboratorio -->
        <div class="medico-filter" style="margin-bottom: 15px; display: none;" id="labMedicoFilterContainer">
          <label for="labMedicoFilter"><i class="fas fa-user-md"></i> Filtrar por médico:</label>
          <select id="labMedicoFilter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;">
            <option value="">Todos los médicos</option>
            <option value="Dr. Luis Coto">Dr. Luis Coto</option>
            <option value="Dr. Randall Azofeifa">Dr. Randall Azofeifa</option>
            <option value="Dr. Gustavo Gonzalez">Dr. Gustavo Gonzalez</option>
            <option value="Dra. Daniela Sancho">Dra. Daniela Sancho</option>
            <option value="Dra. Francinny Nuñez">Dra. Francinny Nuñez</option>
            <option value="Dra. Kharen Moreno">Dra. Kharen Moreno</option>
            <option value="Dra. Karina Madrigal">Dra. Karina Madrigal</option>
            <option value="Dra. Lourdes Chacón">Dra. Lourdes Chacón</option>
            <option value="Dra. Karla Quesada">Dra. Karla Quesada</option>
            <option value="Dra. Natalia Alvarado">Dra. Natalia Alvarado</option>
            <option value="Medico Externo">Médico Externo</option>
            <option value="Dra. Nicole Sibaja">Dra. Nicole Sibaja</option>
            <option value="N.A">N.A</option>
          </select>
        </div>

        <!-- Filtros para laboratorio -->
        <div class="filter-container">
          <button class="lab-filter-btn active" data-filter="todos">Todos</button>
          <button class="lab-filter-btn" data-filter="pendiente">Pendiente</button>
          <button class="lab-filter-btn" data-filter="procesando">En Proceso</button>
          <button class="lab-filter-btn" data-filter="reportado">Reportados por Lab</button>
          <button class="lab-filter-btn" data-filter="reportado_cliente">Reportado al cliente</button>
          <button class="lab-filter-btn" data-filter="internos">Internos</button>
          <button class="lab-filter-btn" data-filter="cliente_no_contesta">Cliente no contesta</button>
        </div>
        
        <!-- Contenedor de tickets de laboratorio -->
        <div id="labTicketContainer" class="ticket-container">
          <!-- Aquí se mostrarán los tickets de laboratorio -->
        </div>

      
      </section>

      <!-- Sección para crear reportes de laboratorio (similar a consentimientos) -->
      <section id="reportesLabSection" class="hidden">
        <h2><i class="fas fa-file-medical"></i> Reportes de Laboratorio</h2>

        <!-- Buscador de clientes (fuente: tickets de laboratorio) -->
        <div class="client-search-section">
          <h3>Buscar Cliente (Tickets de Laboratorio)</h3>
          <div class="search-container">
            <div class="search-input-container">
              <input type="text" id="labReportClientSearch" placeholder="Buscar por nombre, cédula, mascota, ID paciente o factura..." class="search-input">
              <button id="searchLabReportClientBtn" class="search-btn">
                Buscar
              </button>
            </div>
            <div id="labReportClientResults" class="search-results"></div>
          </div>
        </div>

        <!-- Selector de plantilla de reporte de laboratorio -->
        <div class="consent-template-section">
          <h3><i class="fas fa-file-medical"></i> Seleccionar Plantilla de Reporte</h3>
          <div class="template-grid" id="labReportTemplateGrid">
            <div class="template-card" data-template="hemograma"><h4>Hemograma</h4><p>Resultados de hemograma</p></div>
            <div class="template-card" data-template="panel_basico"><h4>Panel Básico</h4><p>Perfil básico</p></div>
            <div class="template-card" data-template="panel_plus"><h4>Panel Plus</h4><p>Perfil ampliado</p></div>
            <div class="template-card" data-template="perfil_quimico"><h4>Perfil Químico</h4><p>Química sanguínea</p></div>
            <div class="template-card" data-template="perfil_renal"><h4>Perfil Renal</h4><p>Función renal</p></div>
            <div class="template-card" data-template="perfil_pre_quirurgico"><h4>Perfil Pre-Quirúrgico</h4><p>Evaluación preoperatoria</p></div>
            <div class="template-card" data-template="heces"><h4>Análisis de Heces</h4><p>Macroscópico/Microscópico</p></div>
            <div class="template-card" data-template="urianalisis"><h4>Urianálisis</h4><p>Análisis de orina</p></div>
            <div class="template-card" data-template="frotis"><h4>Frotis Sanguíneo</h4><p>Morfología sanguínea</p></div>
            <div class="template-card" data-template="reticulocitos"><h4>Conteo de Reticulocitos</h4><p>Análisis de reticulocitos</p></div>
            <div class="template-card" data-template="analisis_liquido_libre"><h4>Análisis Líquido Libre</h4><p>Análisis de fluidos</p></div>
            <div class="template-card" data-template="tests"><h4>Pruebas Rápidas</h4><p>Tests rápidos</p></div>
          </div>
        </div>

        <!-- Visor del reporte -->
        <div id="labReportFormContainer" class="consent-form-container" style="display:none;">
          <div class="form-header">
            <h3 id="selectedLabReportTitle">Reporte Seleccionado</h3>
            <div style="display:flex; gap:8px;">
              <button id="printLabReportBtn" class="close-btn" title="Generar PDF">
                <i class="fas fa-file-pdf"></i> PDF
              </button>
              <button id="closeLabReportBtn" class="close-btn">
                <i class="fas fa-times"></i> Cerrar
              </button>
            </div>
          </div>
          <iframe id="labReportIframe" src="" frameborder="0"></iframe>
        </div>
      </section>

      <!-- Sección para Control de Inyectables -->
      <section id="inyectablesSection" class="hidden">
        <h2><i class="fas fa-syringe"></i> Control de Inyectables</h2>
        
        <!-- Formulario para agregar inyectables -->
        <div class="form-container">
          <form id="inyectablesForm">
            <div class="form-row">
              <div class="form-group">
                <label for="inyFecha"><i class="fas fa-calendar"></i> Fecha: *</label>
                <input type="date" id="inyFecha" required>
              </div>
              <div class="form-group">
                <label for="inyMascotaApellido"><i class="fas fa-paw"></i> Nombre Mascota - Apellido Dueño: *</label>
                <input type="text" id="inyMascotaApellido" placeholder="Ej: Max - García (obligatorio incluir apellido)" required>
              </div>
            </div>
            
            <!-- Inyectables disponibles -->
            <div class="inyectables-grid">
              <div class="form-group checkbox-group">
                <label for="inySelmix">
                  <input type="checkbox" id="inySelmix" value="Selmix">
                  <span class="checkmark"></span>
                  Selmix
                </label>
              </div>
              <div class="form-group checkbox-group">
                <label for="inyConvenia">
                  <input type="checkbox" id="inyConvenia" value="Convenia">
                  <span class="checkmark"></span>
                  Convenia
                </label>
              </div>
              <div class="form-group checkbox-group">
                <label for="inyCerenia">
                  <input type="checkbox" id="inyCerenia" value="Cerenia">
                  <span class="checkmark"></span>
                  Cerenia
                </label>
              </div>
              <div class="form-group checkbox-group">
                <label for="inySoroglobulin">
                  <input type="checkbox" id="inySoroglobulin" value="Soroglobulin">
                  <span class="checkmark"></span>
                  Soroglobulin
                </label>
              </div>
              <div class="form-group checkbox-group">
                <label for="inyNexium">
                  <input type="checkbox" id="inyNexium" value="Nexium">
                  <span class="checkmark"></span>
                  Nexium
                </label>
              </div>
              <div class="form-group checkbox-group">
                <label for="inyOsurnia">
                  <input type="checkbox" id="inyOsurnia" value="Osurnia">
                  <span class="checkmark"></span>
                  Osurnia
                </label>
              </div>
              <div class="form-group checkbox-group">
                <label for="inySueroAutologo">
                  <input type="checkbox" id="inySueroAutologo" value="Suero Autólogo">
                  <span class="checkmark"></span>
                  Suero Autólogo
                </label>
              </div>
              <div class="form-group checkbox-group">
                <label for="inyMetadona">
                  <input type="checkbox" id="inyMetadona" value="Metadona">
                  <span class="checkmark"></span>
                  Metadona
                </label>
              </div>
              <div class="form-group checkbox-group">
                <label for="inyOndansetron">
                  <input type="checkbox" id="inyOndansetron" value="Ondansetrón">
                  <span class="checkmark"></span>
                  Ondansetrón
                </label>
              </div>
              <div class="form-group checkbox-group">
                <label for="inySerentis">
                  <input type="checkbox" id="inySerentis" value="Serentis">
                  <span class="checkmark"></span>
                  Serentis
                </label>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="inyDosis"><i class="fas fa-weight"></i> Dosis: *</label>
                <input type="text" id="inyDosis" placeholder="Dosis administrada" required>
              </div>
              <div class="form-group">
                <label for="inyAFavorDosis"><i class="fas fa-check-circle"></i> A favor (dosis):</label>
                <input type="text" id="inyAFavorDosis" placeholder="Cantidad de dosis a favor" class="a-favor-dosis-input">
              </div>
              <div class="form-group">
                <label for="inySolicitante"><i class="fas fa-user"></i> Solicitante: *</label>
                <input type="text" id="inySolicitante" placeholder="Quien solicita" required>
              </div>
              <div class="form-group">
                <label for="inyQuienDaDosis"><i class="fas fa-user-md"></i> Quien da la dosis: *</label>
                <input type="text" id="inyQuienDaDosis" placeholder="Quien administra" required>
              </div>
              <div class="form-group">
                <label for="inyFactura"><i class="fas fa-file-invoice"></i> Factura:</label>
                <input type="text" id="inyFactura" placeholder="Número de factura (opcional)">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn-submit">
                <i class="fas fa-save"></i> Registrar Inyectable
              </button>
              <button type="button" id="limpiarInyectables" class="btn-cancel">
                <i class="fas fa-eraser"></i> Limpiar
              </button>
            </div>
          </form>
        </div>
        
        <!-- Tabla de inyectables registrados -->
        <div class="inyectables-table-container">
          <h3><i class="fas fa-list"></i> Registro de Inyectables</h3>
          <div class="table-controls">
            <div class="search-controls">
              <input type="text" id="inyectablesSearch" placeholder="Buscar por mascota, solicitante o factura..." class="search-input">
              <button id="searchInyectablesBtn" class="search-btn">
                <i class="fas fa-search"></i> Buscar
              </button>
            </div>
            <div class="filter-controls">
              <input type="date" id="inyectablesDateFilter" placeholder="Filtrar por fecha">
              <button id="filterInyectablesBtn" class="filter-btn">
                <i class="fas fa-filter"></i> Filtrar
              </button>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="inyectables-table">
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Mascota y Apellido</th>
                    <th>Selmix</th>
                    <th>Convenia</th>
                    <th>Cerenia</th>
                    <th>Soroglobulin</th>
                    <th>Nexium</th>
                    <th>Osurnia</th>
                    <th>Suero Autólogo</th>
                    <th>Metadona</th>
                    <th>Ondansetrón</th>
                    <th>Serentis</th>
                    <th>Dosis</th>
                    <th>A favor</th>
                    <th>Dosis A favor</th>
                    <th>Solicitante</th>
                    <th>Quien da la dosis</th>
                    <th>Factura</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
              <tbody id="inyectablesTableBody">
                <!-- Los datos se cargarán dinámicamente -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Sección para Control de Vacunas -->
      <section id="vacunasSection" class="hidden">
        <h2><i class="fas fa-syringe"></i> Control de Vacunas</h2>
        
        <!-- Selección de Fecha y Turno -->
        <div class="form-container">
          <div class="form-row">
            <div class="form-group">
              <label for="vacunasFecha"><i class="fas fa-calendar"></i> Fecha: *</label>
              <input type="date" id="vacunasFecha" required>
            </div>
            <div class="form-group">
              <label for="vacunasTurno"><i class="fas fa-clock"></i> Turno: *</label>
              <select id="vacunasTurno" required>
                <option value="">Seleccionar turno</option>
                <option value="Mañana">Apertura de turno</option>
                <option value="Tarde">Entrega de turno</option>
                <option value="Noche">Cierre de turno</option>
              </select>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" id="cargarVacunasTurno" class="btn-submit">
              <i class="fas fa-eye"></i> Ver Registro del Turno
            </button>
          </div>
        </div>

        <!-- Área para mostrar el registro del turno seleccionado -->
        <div id="vacunasRegistroArea" style="display: none;">
          
          <!-- Apertura de Turno e Inventario -->
          <div class="apertura-turno-container" style="margin-bottom: 30px;">
            <h3><i class="fas fa-clipboard-check"></i> Apertura de Turno e Inventario</h3>
            
            <!-- Botón para abrir turno si no existe -->
            <div id="abrirTurnoSection" style="display: none;">
              <div class="form-container">
                <p style="margin-bottom: 15px; color: #666; font-style: italic;">
                  <i class="fas fa-info-circle"></i> Este turno aún no ha sido abierto. Configure el inventario inicial para comenzar.
                </p>
                <div class="form-group">
                  <label for="responsableApertura"><i class="fas fa-user"></i> Responsable de Apertura: *</label>
                  <input type="text" id="responsableApertura" placeholder="Nombre del responsable" required>
                </div>
                
                <h4 style="color: #2c3e50; margin: 20px 0 15px 0; font-size: 16px;">
                  <i class="fas fa-syringe"></i> Conteo Inicial de Vacunas
                </h4>
                
                <!-- Vacunas Anuales -->
                <div class="vacunas-categoria">
                  <h5 style="color: #4285f4; margin: 15px 0 10px 0; font-weight: 600;">Vacunas:</h5>
                  <div class="inventario-grid">
                    <div class="inventario-item">
                      <label for="inventarioMult">Mult:</label>
                      <input type="number" id="inventarioMult" min="0" value="0" class="inventario-input">
                    </div>
                    <div class="inventario-item">
                      <label for="inventarioPuppy">Puppy:</label>
                      <input type="number" id="inventarioPuppy" min="0" value="0" class="inventario-input">
                    </div>
                    <div class="inventario-item">
                      <label for="inventarioRab">Rab:</label>
                      <input type="number" id="inventarioRab" min="0" value="0" class="inventario-input">
                    </div>
                    <div class="inventario-item">
                      <label for="inventarioTos">Tos:</label>
                      <input type="number" id="inventarioTos" min="0" value="0" class="inventario-input">
                    </div>
                    <div class="inventario-item">
                      <label for="inventarioGiardia">Giardia:</label>
                      <input type="number" id="inventarioGiardia" min="0" value="0" class="inventario-input">
                    </div>
                    <div class="inventario-item">
                      <label for="inventarioC4">C4:</label>
                      <input type="number" id="inventarioC4" min="0" value="0" class="inventario-input">
                    </div>
                    <div class="inventario-item">
                      <label for="inventarioC6">C6:</label>
                      <input type="number" id="inventarioC6" min="0" value="0" class="inventario-input">
                    </div>
                    <div class="inventario-item">
                      <label for="inventarioVacunaAnual">Vacuna Anual:</label>
                      <input type="number" id="inventarioVacunaAnual" min="0" value="0" class="inventario-input">
                    </div>
                  </div>
                </div>
                
                <!-- Vacunas Trimestrales -->
                <div class="vacunas-categoria">
                  <h5 style="color: #4285f4; margin: 15px 0 10px 0; font-weight: 600;">Vacunas:</h5>
                  <div class="inventario-grid">
                    <div class="inventario-item">
                      <label for="inventarioTripLeu">Trip/Leu:</label>
                      <input type="number" id="inventarioTripLeu" min="0" value="0" class="inventario-input">
                    </div>
                    <div class="inventario-item">
                      <label for="inventarioTripRab">Trip/Rab:</label>
                      <input type="number" id="inventarioTripRab" min="0" value="0" class="inventario-input">
                    </div>
                    <div class="inventario-item">
                      <label for="inventarioLeu">Leu:</label>
                      <input type="number" id="inventarioLeu" min="0" value="0" class="inventario-input">
                    </div>
                    <div class="inventario-item">
                      <label for="inventarioTripleFelina">Triple Felina:</label>
                      <input type="number" id="inventarioTripleFelina" min="0" value="0" class="inventario-input">
                    </div>
                  </div>
                </div>
                
                <div class="form-actions">
                  <button type="button" id="abrirTurnoBtn" class="btn-submit">
                    <i class="fas fa-play-circle"></i> Abrir Turno
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Mostrar inventario actual si el turno ya está abierto -->
            <div id="inventarioActualSection" style="display: none;">
              <div class="inventario-actual">
                <div class="inventario-header">
                  <h4><i class="fas fa-boxes"></i> Inventario Actual del Turno</h4>
                  <div class="responsable-info">
                    <span><i class="fas fa-user"></i> Responsable: <strong id="responsableActual"></strong></span>
                    <span><i class="fas fa-clock"></i> Abierto: <strong id="horaApertura"></strong></span>
                  </div>
                </div>
                
                <div class="inventario-tabs">
                  <button class="tab-btn active" onclick="mostrarInventarioTab('anual')">Vacunas</button>
                  <button class="tab-btn" onclick="mostrarInventarioTab('trimestral')">Vacunas</button>
                </div>
                
                <div id="inventarioAnual" class="inventario-tab-content">
                  <div class="inventario-grid-actual">
                    <!-- Se llenará dinámicamente -->
                  </div>
                </div>
                
                <div id="inventarioTrimestral" class="inventario-tab-content" style="display: none;">
                  <div class="inventario-grid-actual">
                    <!-- Se llenará dinámicamente -->
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Formulario para agregar vacuna -->
          <div class="form-container" style="margin-top: 20px;">
            <h3><i class="fas fa-plus-circle"></i> Agregar Registro de Vacuna</h3>
            <form id="vacunasForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="vacunaNombrePaciente"><i class="fas fa-paw"></i> Nombre del Paciente: *</label>
                  <input type="text" id="vacunaNombrePaciente" placeholder="Nombre del paciente" required>
                </div>
                <div class="form-group">
                  <label for="vacunaApellidoCliente"><i class="fas fa-user"></i> Apellido del Cliente: *</label>
                  <input type="text" id="vacunaApellidoCliente" placeholder="Apellido del dueño" required>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="vacunaID"><i class="fas fa-id-card"></i> ID/Registro: *</label>
                  <input type="text" id="vacunaID" placeholder="ID del paciente" required>
                </div>
                <div class="form-group">
                  <label for="vacunaMedico"><i class="fas fa-user-md"></i> Médico/Asistente: *</label>
                  <input type="text" id="vacunaMedico" placeholder="Médico encargado o asistente" required>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="vacunaHora"><i class="fas fa-clock"></i> Hora: *</label>
                  <input type="time" id="vacunaHora" required>
                </div>
                <div class="form-group">
                  <label for="vacunaColocada"><i class="fas fa-syringe"></i> Vacuna Colocada: *</label>
                  <select id="vacunaColocada" required>
                    <option value="">Seleccionar vacuna</option>
                    <optgroup label="Vacunas">
                      <option value="Mult">Mult</option>
                      <option value="Puppy">Puppy</option>
                      <option value="Rab">Rab</option>
                      <option value="Tos">Tos</option>
                      <option value="Giardia">Giardia</option>
                      <option value="C4">C4</option>
                      <option value="C6">C6</option>
                      <option value="Triple Felina">Triple Felina</option>
                      <option value="Vacuna Anual">Vacuna Anual</option>
                    </optgroup>
                    <optgroup label="Vacunas">
                      <option value="Trip/Leu">Trip/Leu</option>
                      <option value="Trip/Rab">Trip/Rab</option>
                      <option value="Leu">Leu</option>
                    </optgroup>
                  </select>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="vacunaFactura"><i class="fas fa-file-invoice"></i> Factura:</label>
                  <input type="text" id="vacunaFactura" placeholder="Número de factura (opcional)">
                </div>
              </div>
              
              <div class="form-actions">
                <button type="submit" class="btn-submit">
                  <i class="fas fa-save"></i> Registrar Vacuna
                </button>
                <button type="button" id="limpiarVacunasForm" class="btn-cancel">
                  <i class="fas fa-eraser"></i> Limpiar
                </button>
              </div>
            </form>
          </div>

          <!-- Tabla de vacunas del turno -->
          <div class="vacunas-table-container" style="margin-top: 20px;">
            <h3><i class="fas fa-list"></i> Registro de Vacunas del Turno</h3>
            
            <div class="table-responsive">
              <table class="vacunas-table">
                <thead>
                  <tr>
                    <th>Hora</th>
                    <th>Nombre Paciente</th>
                    <th>Apellido Cliente</th>
                    <th>ID</th>
                    <th>Médico/Asistente</th>
                    <th>Vacuna Colocada</th>
                    <th>Factura</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="vacunasTableBody">
                  <!-- Los datos se cargarán dinámicamente -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Área de notas del turno -->
          <div class="notas-turno-container" style="margin-top: 20px;">
            <h3><i class="fas fa-sticky-note"></i> Notas del Turno</h3>
            <div class="form-group">
              <label for="vacunasNotasTurno"><i class="fas fa-comment"></i> Agregar o editar notas:</label>
              <textarea id="vacunasNotasTurno" rows="4" placeholder="Escriba las notas para este turno..."></textarea>
            </div>
            <div class="form-actions">
              <button type="button" id="guardarVacunasNotas" class="btn-submit">
                <i class="fas fa-save"></i> Guardar Notas
              </button>
            </div>
          </div>
        </div>

      </section>
      
      <!-- Sección para ver consentimientos -->
      <section id="verConsentimientosSection" class="hidden">
        <h2><i class="fas fa-file-contract"></i> Consentimientos Registrados</h2>
        
        <!-- Filtros de consentimientos -->
        <div class="consentimientos-filters" style="margin-bottom: 20px;">
          <div class="form-row">
            <div class="form-group">
              <label for="consentimientosFechaFiltro"><i class="fas fa-calendar-alt"></i> Filtrar por fecha:</label>
              <input type="date" id="consentimientosFechaFiltro">
            </div>
            <div class="form-group">
              <label for="consentimientosTipoFiltro"><i class="fas fa-filter"></i> Tipo de consentimiento:</label>
              <select id="consentimientosTipoFiltro">
                <option value="todos">Todos los tipos</option>
                <option value="anestesia">Anestesia</option>
                <option value="cirugia">Cirugía</option>
                <option value="emergencias">Emergencias</option>
                <option value="internamiento">Internamiento</option>
                <option value="transfusion">Transfusión</option>
                <option value="cesarea">Cesárea</option>
                <option value="eutanasia">Eutanasia</option>
                <option value="alta_voluntaria">Alta Voluntaria</option>
              </select>
            </div>
            <button id="aplicarFiltrosConsentimientos" class="btn-submit">
              <i class="fas fa-filter"></i> Aplicar Filtros
            </button>
          </div>
        </div>

        <!-- Barra de búsqueda para consentimientos -->
        <div class="search-bar" style="margin-bottom: 15px;">
          <input type="text" id="consentimientosSearchInput" placeholder="Buscar por cliente, mascota, tipo de consentimiento..." autocomplete="off">
        </div>
        
        <!-- Contenedor de consentimientos -->
        <div id="consentimientosContainer" class="consentimientos-grid">
          <!-- Aquí se mostrarán los consentimientos -->
        </div>

        <!-- Estadísticas de consentimientos -->
        <div class="consentimientos-stats" style="margin-top: 20px;">
          <div class="stats-grid">
            <div class="stat-card">
              <i class="fas fa-file-contract"></i>
              <div class="stat-info">
                <span class="stat-number" id="totalConsentimientos">0</span>
                <span class="stat-label">Total Consentimientos</span>
              </div>
            </div>
            <div class="stat-card">
              <i class="fas fa-calendar-day"></i>
              <div class="stat-info">
                <span class="stat-number" id="consentimientosHoy">0</span>
                <span class="stat-label">Hoy</span>
              </div>
            </div>
            <div class="stat-card">
              <i class="fas fa-file-medical"></i>
              <div class="stat-info">
                <span class="stat-number" id="consentimientosCirugia">0</span>
                <span class="stat-label">Cirugía</span>
              </div>
            </div>
            <div class="stat-card">
              <i class="fas fa-syringe"></i>
              <div class="stat-info">
                <span class="stat-number" id="consentimientosAnestesia">0</span>
                <span class="stat-label">Anestesia</span>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Sección para crear tickets de quirófano -->
      <section id="crearQuirofanoSection" class="hidden">
        <h2><i class="fas fa-cut"></i> Crear Ticket de Quirófano</h2>
        <div class="form-container">
          <form id="quirofanoTicketForm">
            <div class="form-row">
              <div class="form-group">
                <label for="quirofanoNombre">Nombre del Cliente</label>
                <input type="text" id="quirofanoNombre" required>
              </div>
              <div class="form-group">
                <label for="quirofanoCedula">Cédula</label>
                <input type="text" id="quirofanoCedula" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="quirofanoCorreo">Correo Electrónico</label>
                <input type="text" id="quirofanoCorreo">
              </div>
              <div class="form-group">
                <label for="quirofanoTelefono">Teléfono</label>
                <input type="tel" id="quirofanoTelefono">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="quirofanoFactura">Número de Factura</label>
                <input type="text" id="quirofanoFactura">
              </div>
              <div class="form-group">
                <!-- Campo vacío para mantener el diseño de dos columnas -->
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="quirofanoMascota">Nombre de la Mascota</label>
                <input type="text" id="quirofanoMascota" required>
              </div>
              <div class="form-group">
                <label for="quirofanoTipoMascota">Tipo de Mascota</label>
                <select id="quirofanoTipoMascota" required>
                  <option value="perro">Perro</option>
                  <option value="gato">Gato</option>
                  <option value="conejo">Conejo</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="quirofanoRaza">Raza</label>
                <input type="text" id="quirofanoRaza" placeholder="Ej: Labrador, Persa, SRD">
              </div>
              <div class="form-group">
                <label for="quirofanoPeso">Peso (kg)</label>
                <input type="text" id="quirofanoPeso" placeholder="Ej: 5.2 kg, 3 libras">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="quirofanoEdad">Edad de la Mascota</label>
                <input type="text" id="quirofanoEdad" placeholder="Ej: 3 años, 8 meses">
              </div>
              <div class="form-group">
                <label for="quirofanoExamenesPrequirurgicos">
                  <input type="checkbox" id="quirofanoExamenesPrequirurgicos" style="margin-right: 8px;">
                  Exámenes Pre Quirúrgicos
                </label>
                <small style="display: block; color: #666; margin-top: 4px;">
                  Marque si el paciente requiere exámenes antes de la cirugía
                </small>
                

              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="quirofanoIdPaciente">ID del Paciente</label>
                <input type="text" id="quirofanoIdPaciente" required>
              </div>
              <div class="form-group">
                <label for="quirofanoFecha">Fecha de Cirugía</label>
                <input type="date" id="quirofanoFecha" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="quirofanoHora">Hora de Cirugía</label>
                <input type="time" id="quirofanoHora">
              </div>
              <div class="form-group">
                <label for="quirofanoUrgencia">Categorización de Paciente</label>
                <select id="quirofanoUrgencia" required>
                  <option value="normal">🔵 Cirugía Regular</option>
                  <option value="media">🟣 Cirugía Programada</option>
                  <option value="alta">🟠 Cirugía Urgente</option>
                  <option value="emergencia">🔴 Cirugía de Emergencia</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="quirofanoDoctorAtiende"><i class="fas fa-user-md"></i> Doctor que atiende</label>
                <select id="quirofanoDoctorAtiende">
                  <option value="">Seleccione un doctor</option>
                  <option value="Dr. Luis Coto">Dr. Luis Coto</option>
                  <option value="Dr. Randall Azofeifa">Dr. Randall Azofeifa</option>
                  <option value="Dr. Gustavo Gonzalez">Dr. Gustavo Gonzalez</option>
                  <option value="Dra. Daniela Sancho">Dra. Daniela Sancho</option>
                  <option value="Dra. Francinny Nuñez">Dra. Francinny Nuñez</option>
                  <option value="Dra. Kharen Moreno">Dra. Kharen Moreno</option>
                  <option value="Dra. Karina Madrigal">Dra. Karina Madrigal</option>
                  <option value="Dra. Lourdes Chacón">Dra. Lourdes Chacón</option>
                  <option value="Dra. Karla Quesada">Dra. Karla Quesada</option>
                  <option value="Dra. Natalia Alvarado">Dra. Natalia Alvarado</option>
                  <option value="Dra. Nicole Sibaja">Dra. Nicole Sibaja</option>
                </select>
              </div>
              <div class="form-group">
                <label for="quirofanoAsistenteAtiende"><i class="fas fa-user-nurse"></i> Asistente que atiende</label>
                <select id="quirofanoAsistenteAtiende">
                  <option value="">Seleccione un asistente</option>
                  <option value="Tec. Maribel Guzmán">Tec. Maribel Guzmán</option>
                  <option value="Tec. Juliana Perez">Tec. Juliana Perez</option>
                  <option value="Tec. Jafeth Bermudez">Tec. Jafeth Bermudez</option>
                  <option value="Tec. Gabriela Zuñiga">Tec. Gabriela Zuñiga</option>
                  <option value="Tec. Indra Perez">Tec. Indra Perez</option>
                  <option value="Tec. Randy Arias">Tec. Randy Arias</option>
                  <option value="Tec. Yancy Picado">Tec. Yancy Picado</option>
                  <option value="Tec. Maria Fernanda">Tec. Maria Fernanda</option>
                  <option value="Tec. Nicole Gamboa">Tec. Nicole Gamboa</option>
                  <option value="Tec. Paola López">Tec. Paola López</option>
                  <option value="Tec. Alexander Ureña">Tec. Alexander Ureña</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="quirofanoProcedimiento">Tipo de Procedimiento</label>
                <input type="text" id="quirofanoProcedimiento" placeholder="Ej: Esterilización, Castración, Cesárea, etc.">
              </div>
            </div>

            <div class="form-group full-width">
              <label for="quirofanoMotivo">Motivo/Descripción del Procedimiento</label>
              <textarea id="quirofanoMotivo" placeholder="Describa el motivo y detalles del procedimiento quirúrgico" required></textarea>
            </div>

            <button type="submit" class="btn-submit"><i class="fas fa-cut"></i> Crear Ticket de Quirófano</button>
          </form>
        </div>
      </section>

      <!-- Sección para ver tickets de quirófano -->
      <section id="verQuirofanoSection" class="hidden">
        <h2><i class="fas fa-cut"></i> Tickets de Quirófano</h2>
        
        <!-- Filtros de quirófano -->
        <div class="quirofano-filters" style="margin-bottom: 20px;">
          <div class="form-row">
            <div class="form-group">
              <label for="quirofanoFilterDate"><i class="fas fa-calendar-alt"></i> Filtrar por fecha:</label>
              <input type="date" id="quirofanoFilterDate">
            </div>
          </div>
        </div>

        <!-- Botones de filtro por estado -->
        <div class="filter-container">
          <button class="quirofano-filter-btn" data-filter="todos" id="quirofanoFilterTodos">Todos</button>
                        <button class="quirofano-filter-btn active" data-filter="en-preparacion">En Preparación</button>
                        <button class="quirofano-filter-btn" data-filter="listo-para-cirugia">Listo para Cirugía</button>
                        <button class="quirofano-filter-btn" data-filter="en-cirugia">En Cirugía</button>
                        <button class="quirofano-filter-btn" data-filter="terminado">Terminados</button>
        </div>

        <!-- Barra de búsqueda para quirófano -->
        <div class="search-bar" style="margin-bottom: 15px;">
          <input type="text" id="quirofanoSearchInput" placeholder="Buscar por cliente, mascota, ID paciente..." autocomplete="off">
        </div>
        
        <!-- Contenedor de tickets de quirófano -->
        <div id="quirofanoTicketContainer" class="quirofano-ticket-container">
          <!-- Aquí se mostrarán los tickets de quirófano -->
        </div>
      </section>

      <!-- ========== MÓDULO DE INTERNAMIENTO ========== -->
      
      <!-- Sección para registrar pacientes internados -->
      <section id="crearInternamientoSection" class="hidden">
        <h2><i class="fas fa-home"></i> Registrar Paciente Internado</h2>
        <div class="form-container">
          <form id="internamientoForm">
            <!-- Búsqueda de Cliente -->
            <div class="form-section">
              <h3><i class="fas fa-search"></i> Buscar Cliente</h3>
              <div class="form-row">
                <div class="form-group" style="position: relative;">
                  <label for="intClienteSearch">Buscar Cliente</label>
                  <input type="text" id="intClienteSearch" placeholder="Escriba nombre, cédula o ID del paciente..." autocomplete="off">
                  <div id="intClienteResults" class="cliente-search-results"></div>
                </div>
                <div class="form-group">
                  <label for="intFechaFiltro"><i class="fas fa-calendar-alt"></i> Filtrar por Fecha de Consulta</label>
                  <input type="date" id="intFechaFiltro" required>
                </div>
              </div>
            </div>

            <!-- Información del Paciente -->
            <div class="form-section">
              <h3><i class="fas fa-paw"></i> Información del Paciente</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="intNombre">Nombre del Cliente</label>
                  <input type="text" id="intNombre" required>
                </div>
                <div class="form-group">
                  <label for="intCedula">Cédula</label>
                  <input type="text" id="intCedula" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="intMascota">Nombre de la Mascota</label>
                  <input type="text" id="intMascota" required>
                </div>
                <div class="form-group">
                  <label for="intTipoMascota">Tipo de Mascota</label>
                  <select id="intTipoMascota" required>
                    <option value="perro">Perro</option>
                    <option value="gato">Gato</option>
                    <option value="conejo">Conejo</option>
                    <option value="otro">Otro</option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="intEdad">Edad</label>
                  <input type="text" id="intEdad" placeholder="Ej: 2 años, 6 meses" required>
                </div>
                <div class="form-group">
                  <label for="intRaza">Raza</label>
                  <input type="text" id="intRaza" placeholder="Ej: Labrador, Persa, SRD">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="intPeso">Peso (kg)</label>
                  <input type="text" id="intPeso" placeholder="Ej: 5.2 kg" required>
                </div>
                <div class="form-group">
                  <label for="intSexo">Sexo</label>
                  <select id="intSexo" required>
                    <option value="">Seleccionar</option>
                    <option value="macho">Macho</option>
                    <option value="hembra">Hembra</option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="intIdPaciente">ID del Paciente</label>
                  <input type="text" id="intIdPaciente" required>
                </div>
                <div class="form-group">
                  <label for="intTemperatura">Temperatura (°C)</label>
                  <input type="number" id="intTemperatura" step="0.1" placeholder="38.5">
                </div>
              </div>
            </div>

            <!-- Información del Propietario -->
            <div class="form-section">
              <h3><i class="fas fa-user"></i> Información del Propietario</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="intPropietario">Propietario</label>
                  <input type="text" id="intPropietario" required>
                </div>
                <div class="form-group">
                  <label for="intTelefono">Teléfono</label>
                  <input type="tel" id="intTelefono" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="intEmail">Email</label>
                  <input type="email" id="intEmail">
                </div>
                <div class="form-group">
                  <label for="intFactura">Número de Factura</label>
                  <input type="text" id="intFactura">
                </div>
              </div>
            </div>

            <!-- Información Médica -->
            <div class="form-section">
              <h3><i class="fas fa-stethoscope"></i> Información Médica</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="intMedicoEncargado">Médico Encargado</label>
                  <select id="intMedicoEncargado" required>
                    <option value="">Seleccione un médico</option>
                    <option value="Dr. Luis Coto">Dr. Luis Coto</option>
                    <option value="Dr. Randall Azofeifa">Dr. Randall Azofeifa</option>
                    <option value="Dr. Gustavo Gonzalez">Dr. Gustavo Gonzalez</option>
                    <option value="Dra. Daniela Sancho">Dra. Daniela Sancho</option>
                    <option value="Dra. Francinny Nuñez">Dra. Francinny Nuñez</option>
                    <option value="Dra. Kharen Moreno">Dra. Kharen Moreno</option>
                    <option value="Dra. Karina Madrigal">Dra. Karina Madrigal</option>
                    <option value="Dra. Lourdes Chacón">Dra. Lourdes Chacón</option>
                    <option value="Dra. Karla Quesada">Dra. Karla Quesada</option>
                    <option value="Dra. Natalia Alvarado">Dra. Natalia Alvarado</option>
                    <option value="Dra. Nicole Sibaja">Dra. Nicole Sibaja</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="intFechaIngreso">Fecha de Ingreso</label>
                  <input type="date" id="intFechaIngreso" required>
                </div>
              </div>

              <div class="form-group">
                <label for="intHistoriaClinica">Historia Clínica</label>
                <textarea id="intHistoriaClinica" placeholder="Describa la historia clínica del paciente" rows="3"></textarea>
              </div>

              <div class="form-group">
                <label for="intDiagnosticoPresuntivo">Diagnóstico Presuntivo</label>
                <textarea id="intDiagnosticoPresuntivo" placeholder="Diagnóstico presuntivo o motivo del internamiento" rows="3"></textarea>
              </div>

              <div class="form-group">
                <label for="intPadecimientosPrevios">Padecimientos o Enfermedades Previas</label>
                <textarea id="intPadecimientosPrevios" placeholder="Enfermedades previas conocidas" rows="2"></textarea>
              </div>
            </div>

            <!-- Checklist de Procedimientos -->
            <div class="form-section">
              <h3><i class="fas fa-clipboard-check"></i> Checklist de Procedimientos</h3>
              <div class="checklist-grid">
                <label class="checkbox-label">
                  <input type="checkbox" id="intMuestras">
                  <span>Tomaron Muestras</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="intExamenes">
                  <span>Tiene Exámenes</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="intUltrasonido">
                  <span>Ultrasonido</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="intCastrado">
                  <span>Castrado</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="intVacunaDesparasitacion">
                  <span>Vacuna y Desparasitación</span>
                </label>
              </div>
            </div>

            <button type="submit" class="btn-submit">
              <i class="fas fa-home"></i> Registrar Paciente Internado
            </button>
          </form>
        </div>
      </section>

      <!-- Sección para ver pacientes internados -->
      <section id="verInternamientoSection" class="hidden">
        <h2><i class="fas fa-list"></i> Pacientes Internados</h2>
        
        <!-- Filtros -->
        <div class="internamiento-filters" style="margin-bottom: 20px;">
          <div class="form-row">
            <div class="form-group">
              <label for="intFilterDate"><i class="fas fa-calendar-alt"></i> Filtrar por fecha:</label>
              <input type="date" id="intFilterDate">
            </div>
            <div class="form-group">
              <label for="intFilterEstado"><i class="fas fa-filter"></i> Estado:</label>
              <select id="intFilterEstado">
                <option value="todos">Todos</option>
                <option value="internado">Internado</option>
                <option value="alta">Dado de Alta</option>
                <option value="critico">Crítico</option>
                <option value="estable">Estable</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Barra de búsqueda -->
        <div class="search-bar" style="margin-bottom: 15px;">
          <input type="text" id="intSearchInput" placeholder="Buscar por cliente, mascota, ID paciente..." autocomplete="off">
        </div>

        <!-- Contenedor de pacientes internados -->
        <div id="intPacientesContainer" class="int-pacientes-container">
          <!-- Aquí se mostrarán los pacientes internados -->
        </div>
      </section>

      <!-- Sección de monitoreo de parámetros vitales -->
      <section id="monitoreoInternamientoSection" class="hidden">
        <h2><i class="fas fa-heartbeat"></i> Control de Internamiento</h2>
        
        <!-- Selector de paciente -->
        <div class="form-row" style="margin-bottom: 20px;">
          <div class="form-group">
            <label for="intPacienteMonitoreo">Seleccionar Paciente:</label>
            <select id="intPacienteMonitoreo" required>
              <option value="">Seleccione un paciente internado</option>
            </select>
          </div>
          <div class="form-group">
            <label for="intFechaMonitoreo">Fecha:</label>
            <input type="date" id="intFechaMonitoreo" required>
          </div>
        </div>

        <!-- Formulario de monitoreo horizontal -->
        <div id="intMonitoreoForm" class="monitoring-container" style="display: none;">
          <form id="monitoreoForm">
            
            <!-- Información del Paciente -->
            <div class="patient-info-section">
              <div class="patient-header">
                <div class="clinic-logo">
                  <img src="logo.jpg" alt="Veterinaria San Martin de Porres" style="max-width: 80px;">
                  <h3>Veterinaria San Martin de Porres</h3>
                </div>
                <h2>CONTROL DE INTERNAMIENTO</h2>
                <div class="patient-details">
                  <div class="detail-row">
                    <span><strong>Expediente N°:</strong> <input type="text" id="expedienteNum" readonly></span>
                    <span><strong>Paciente:</strong> <input type="text" id="pacienteNombre" readonly></span>
                    <span><strong>Propietario:</strong> <input type="text" id="propietarioNombre" readonly></span>
                  </div>
                  <div class="detail-row">
                    <span><strong>Historia Clínica:</strong> <input type="text" id="historiaClinica" readonly></span>
                    <span><strong>Dx Presuntivo:</strong> <input type="text" id="diagnosticoPresuntivo" readonly></span>
                  </div>
                  <div class="detail-row">
                    <span><strong>Médico Encargado:</strong> <input type="text" id="medicoEncargado" readonly></span>
                    <span><strong>Fecha Ingreso:</strong> <input type="text" id="fechaIngreso" readonly></span>
                    <span><strong>Fecha Salida:</strong> <input type="text" id="fechaSalida" readonly></span>
                  </div>
                  <div class="detail-row">
                    <span><strong>Edad:</strong> <input type="text" id="edadPaciente" readonly></span>
                    <span><strong>Raza:</strong> <input type="text" id="razaPaciente" readonly></span>
                    <span><strong>Especie:</strong> <input type="text" id="especiePaciente" readonly></span>
                    <span><strong>Sexo:</strong> <input type="text" id="sexoPaciente" readonly></span>
                  </div>
                  <div class="detail-row">
                    <span><strong>Peso:</strong> <input type="text" id="pesoPaciente" readonly></span>
                    <span><strong>Temp:</strong> <input type="text" id="temperaturaPaciente" readonly></span>
                    <span><strong>Cédula:</strong> <input type="text" id="cedulaPropietario" readonly></span>
                    <span><strong>Teléfono:</strong> <input type="text" id="telefonoPropietario" readonly></span>
                  </div>
                  <div class="detail-row">
                    <span><strong>Email:</strong> <input type="text" id="emailPropietario" readonly></span>
                    <span><strong>Padecimientos previos:</strong> <input type="text" id="padecimientosPrevios" readonly></span>
                  </div>
                </div>
                
                <!-- Checklist de procedimientos -->
                <div class="procedures-checklist">
                  <h4>Procedimientos Realizados:</h4>
                  <div class="checklist-grid">
                    <label><input type="checkbox" id="muestrasTomadas"> Tomaron Muestras?</label>
                    <label><input type="checkbox" id="tieneExamenes"> Tiene Exámenes?</label>
                    <label><input type="checkbox" id="ultrasonidoRealizado"> Ultrasonido</label>
                    <label><input type="checkbox" id="castradoRealizado"> Castrado</label>
                    <label><input type="checkbox" id="vacunaDesparasitacion"> Vacuna y Despa</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tabla de Medicamentos Horizontal -->
            <div class="medications-section">
              <h3><i class="fas fa-pills"></i> Control de Medicamentos</h3>
              <div class="medications-table-container">
                <table class="medications-horizontal-table">
                  <thead>
                    <tr>
                      <th rowspan="2">MEDICAMENTO</th>
                      <th rowspan="2">DOSIS</th>
                      <th rowspan="2">ADM</th>
                      <th rowspan="2">VÍA</th>
                      <th colspan="4">HORAS</th>
                      <th colspan="4">DÍA 1</th>
                      <th colspan="4">DÍA 2</th>
                      <th colspan="4">DÍA 3</th>
                      <th colspan="4">DÍA 4</th>
                    </tr>
                    <tr>
                      <th>12am-6am</th>
                      <th>6am-12pm</th>
                      <th>12pm-6pm</th>
                      <th>6pm-12am</th>
                      <th>12am-6am</th>
                      <th>6am-12pm</th>
                      <th>12pm-6pm</th>
                      <th>6pm-12am</th>
                      <th>12am-6am</th>
                      <th>6am-12pm</th>
                      <th>12pm-6pm</th>
                      <th>6pm-12am</th>
                      <th>12am-6am</th>
                      <th>6am-12pm</th>
                      <th>12pm-6pm</th>
                      <th>6pm-12am</th>
                      <th>12am-6am</th>
                      <th>6am-12pm</th>
                      <th>12pm-6pm</th>
                      <th>6pm-12am</th>
                    </tr>
                  </thead>
                  <tbody id="medicationsTableBody">
                    <!-- Se llenará dinámicamente -->
                  </tbody>
                </table>
              </div>
              
              <!-- Observaciones de medicamentos -->
              <div class="medication-observations">
                <label for="observacionesMedicamentos"><strong>OBSERVACION MEDICAMENTOS:</strong></label>
                <input type="text" id="observacionesMedicamentos" placeholder="Observaciones sobre medicamentos...">
              </div>
            </div>

            <!-- Grid de Parámetros Vitales -->
            <div class="parameters-section">
              <h3><i class="fas fa-thermometer-half"></i> Parámetros Vitales</h3>
              <div class="parameters-grid-container">
                <table class="parameters-horizontal-table">
                  <thead>
                    <tr>
                      <th rowspan="2">PARÁMETROS</th>
                      <th colspan="3">DÍA 1</th>
                      <th colspan="3">DÍA 2</th>
                      <th colspan="3">DÍA 3</th>
                      <th colspan="3">DÍA 4</th>
                    </tr>
                    <tr>
                      <th>Mañana</th>
                      <th>Tarde</th>
                      <th>Noche</th>
                      <th>Mañana</th>
                      <th>Tarde</th>
                      <th>Noche</th>
                      <th>Mañana</th>
                      <th>Tarde</th>
                      <th>Noche</th>
                      <th>Mañana</th>
                      <th>Tarde</th>
                      <th>Noche</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Comió (Si, No, Poco, Mucho, A asistido, S sonda)</strong></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                    </tr>
                    <tr>
                      <td><strong>Bebió (Si, No, Poco, Mucho, A asistido, S sonda)</strong></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                    </tr>
                    <tr>
                      <td><strong>Vomitó (Si, No, Poco, Mucho, A asistido, S sonda)</strong></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                    </tr>
                    <tr>
                      <td><strong>Defecó (Si, No, Poco, Mucho, D duro, L líquido, P pastoso, S sangre, M melena)</strong></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                    </tr>
                    <tr>
                      <td><strong>Orinó (Si, No, Poco, Mucho, A amarillo, C claro, R rojo, S sonda)</strong></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                    </tr>
                    <tr>
                      <td><strong>Fluidos:</strong></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                    </tr>
                    <tr>
                      <td><strong>Vp:</strong></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                      <td><input type="text" class="parameter-input"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Información de Alimentación -->
            <div class="feeding-section">
              <h3><i class="fas fa-utensils"></i> Información de Alimentación</h3>
              <div class="feeding-table">
                <table>
                  <thead>
                    <tr>
                      <th>TIPO ALIMENTO</th>
                      <th>RACIÓN</th>
                      <th>FRECUENCIA</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><input type="text" class="feeding-input"></td>
                      <td><input type="text" class="feeding-input"></td>
                      <td><input type="text" class="feeding-input"></td>
                    </tr>
                    <tr>
                      <td><input type="text" class="feeding-input"></td>
                      <td><input type="text" class="feeding-input"></td>
                      <td><input type="text" class="feeding-input"></td>
                    </tr>
                    <tr>
                      <td><input type="text" class="feeding-input"></td>
                      <td><input type="text" class="feeding-input"></td>
                      <td><input type="text" class="feeding-input"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Observaciones Generales -->
            <div class="observations-section">
              <h3><i class="fas fa-sticky-note"></i> Observaciones</h3>
              <div class="observations-grid">
                <div class="observation-field">
                  <label for="consideracionesEspeciales"><strong>CONSIDERACIONES ESPECIALES:</strong></label>
                  <textarea id="consideracionesEspeciales" rows="3" placeholder="Consideraciones especiales del paciente..."></textarea>
                </div>
                <div class="observation-field">
                  <label for="observacionesRX"><strong>OBSERVACIONES EN RX, US Y HG+QX:</strong></label>
                  <textarea id="observacionesRX" rows="3" placeholder="Observaciones de exámenes..."></textarea>
                </div>
                <div class="observation-field">
                  <label for="observacionesGenerales"><strong>OBSERVACIONES GENERALES:</strong></label>
                  <textarea id="observacionesGenerales" rows="3" placeholder="Observaciones generales..."></textarea>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="agregarMedicamentoHorizontal()">
                <i class="fas fa-plus"></i> Agregar Medicamento
              </button>
              <button type="button" class="btn btn-secondary" onclick="imprimirFormulario()">
                <i class="fas fa-print"></i> Imprimir
              </button>
              <button type="button" class="btn btn-secondary" onclick="exportarPDF()">
                <i class="fas fa-file-pdf"></i> Exportar PDF
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Guardar Control
              </button>
            </div>
          </form>
        </div>
      </section>

      <!-- Sección de control de medicamentos -->
      <section id="medicamentosInternamientoSection" class="hidden">
        <h2><i class="fas fa-pills"></i> Control de Medicamentos</h2>
        
        <!-- Selector de paciente -->
        <div class="form-row" style="margin-bottom: 20px;">
          <div class="form-group">
            <label for="intPacienteMedicamentos">Seleccionar Paciente:</label>
            <select id="intPacienteMedicamentos" required>
              <option value="">Seleccione un paciente internado</option>
            </select>
          </div>
          <div class="form-group">
            <label for="intFechaMedicamentos">Fecha:</label>
            <input type="date" id="intFechaMedicamentos" required>
          </div>
        </div>

        <!-- Formulario de medicamentos -->
        <div id="intMedicamentosForm" class="form-container" style="display: none;">
          <form id="medicamentosForm">
            <div class="form-section">
              <h3><i class="fas fa-prescription-bottle"></i> Agregar Medicamento</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="intMedicamento">Medicamento</label>
                  <input type="text" id="intMedicamento" placeholder="Nombre del medicamento" required>
                </div>
                <div class="form-group">
                  <label for="intDosis">Dosis</label>
                  <input type="text" id="intDosis" placeholder="Ej: 10mg, 2ml" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="intVia">Vía de Administración</label>
                  <select id="intVia" required>
                    <option value="">Seleccionar</option>
                    <option value="oral">Oral</option>
                    <option value="intravenosa">Intravenosa</option>
                    <option value="intramuscular">Intramuscular</option>
                    <option value="subcutanea">Subcutánea</option>
                    <option value="topica">Tópica</option>
                    <option value="oftalmica">Oftálmica</option>
                    <option value="otica">Ótica</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="intFrecuencia">Frecuencia</label>
                  <input type="text" id="intFrecuencia" placeholder="Ej: Cada 8 horas, 2 veces al día" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="intDuracion">Duración del Tratamiento</label>
                  <input type="text" id="intDuracion" placeholder="Ej: 7 días, hasta mejoría">
                </div>
                <div class="form-group">
                  <label for="intObservacionesMed">Observaciones</label>
                  <input type="text" id="intObservacionesMed" placeholder="Instrucciones especiales">
                </div>
              </div>

              <button type="button" id="intAgregarMedicamento" class="btn-secondary">
                <i class="fas fa-plus"></i> Agregar Medicamento
              </button>
            </div>

            <!-- Tabla de medicamentos -->
            <div class="form-section">
              <h3><i class="fas fa-table"></i> Medicamentos Prescritos</h3>
              <div class="medicamentos-table-container">
                <table id="intMedicamentosTable" class="medicamentos-table">
                  <thead>
                    <tr>
                      <th>Medicamento</th>
                      <th>Dosis</th>
                      <th>Vía</th>
                      <th>Frecuencia</th>
                      <th>Duración</th>
                      <th>Observaciones</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="intMedicamentosTableBody">
                    <!-- Se llenará dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Horarios de administración -->
            <div class="form-section">
              <h3><i class="fas fa-clock"></i> Horarios de Administración</h3>
              <div class="horarios-container">
                <div class="horarios-grid">
                  <div class="horario-column">
                    <h4>12am - 6am</h4>
                    <div id="horarioMadrugada" class="horario-slots">
                      <!-- Se llenará dinámicamente -->
                    </div>
                  </div>
                  <div class="horario-column">
                    <h4>6am - 12pm</h4>
                    <div id="horarioManana" class="horario-slots">
                      <!-- Se llenará dinámicamente -->
                    </div>
                  </div>
                  <div class="horario-column">
                    <h4>12pm - 6pm</h4>
                    <div id="horarioTarde" class="horario-slots">
                      <!-- Se llenará dinámicamente -->
                    </div>
                  </div>
                  <div class="horario-column">
                    <h4>6pm - 12am</h4>
                    <div id="horarioNoche" class="horario-slots">
                      <!-- Se llenará dinámicamente -->
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <button type="submit" class="btn-submit">
              <i class="fas fa-save"></i> Guardar Medicamentos
            </button>
          </form>
        </div>
      </section>
      
      <!-- Sección de estadísticas -->
      <section id="estadisticasSection" class="hidden">
        <h2><i class="fas fa-chart-bar"></i> Estadísticas</h2>
        <!-- Filtro global de periodo y fechas para estadísticas -->
        <div class="filtros-estadisticas-global" style="margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 16px; align-items: flex-end;">
          <div class="filtro-grupo">
            <label for="filtroPeriodoGlobal">Período:</label>
            <select id="filtroPeriodoGlobal">
              <option value="hoy">Hoy</option>
              <option value="semana">Esta semana</option>
              <option value="mes">Este mes</option>
              <option value="ano">Este año</option>
              <option value="personalizado">Personalizado</option>
            </select>
          </div>
          <div id="periodPersonalizadoGlobal" class="filtro-periodo-personalizado" style="display: none; gap: 8px;">
            <div class="filtro-fecha">
              <label for="fechaInicioEstadisticasGlobal">Desde:</label>
              <input type="date" id="fechaInicioEstadisticasGlobal">
            </div>
            <div class="filtro-fecha">
              <label for="fechaFinEstadisticasGlobal">Hasta:</label>
              <input type="date" id="fechaFinEstadisticasGlobal">
            </div>
          </div>
          <button id="aplicarFiltrosEstadisticasBtn" class="btn-filtrar" style="margin-left: 8px;">
            <i class="fas fa-filter"></i> Aplicar filtros
          </button>
        </div>
        <div class="stats-container">
          <div class="stat-card">
            <i class="fas fa-users"></i>
            <h3>Total Pacientes</h3>
            <p id="totalPacientes">0</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-hourglass-half"></i>
            <h3>En Espera</h3>
            <p id="pacientesEspera">0</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-stethoscope"></i>
            <h3>En Consulta</h3>
            <p id="pacientesConsulta">0</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-check-circle"></i>
            <h3>Atendidos</h3>
            <p id="pacientesAtendidos">0</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-user-slash"></i>
            <h3>Clientes que se fueron</h3>
            <p id="clientesSeFueron">0</p>
          </div>
        </div>
    

        <!-- Nuevo: Sección de tiempo promedio de espera por servicio -->
        <section class="wait-time-statistics">
          <h3><i class="fas fa-hourglass-half"></i> Tiempo Promedio de Espera por Servicio</h3>
          <div class="wait-time-chart">
            <canvas id="waitTimeChart"></canvas>
          </div>
          <div class="wait-time-table">
            <table class="stats-table">
              <thead>
                <tr>
                  <th>Servicio</th>
                  <th>Tiempo Promedio</th>
                  <th>Cantidad</th>
                </tr>
              </thead>
              <tbody id="waitTimeStatsBody">
                <!-- Se llenará dinámicamente -->
              </tbody>
            </table>
          </div>
        </section>

        <div class="estadisticas-personal-section">
          <h3><i class="fas fa-user-md"></i> Estadísticas por Personal y Servicio</h3>
          
          <div class="estadisticas-resultados">
            <div class="charts-container">
              <div class="chart-wrapper">
                <h4>Servicios por Personal</h4>
                <canvas id="chartServiciosPersonal"></canvas>
              </div>
              <div class="chart-wrapper">
                <h4>Distribución de Servicios</h4>
                <canvas id="chartDistribucionServicios"></canvas>
              </div>
            </div>
            
            <div class="tabla-estadisticas">
              <h4>Detalles por Personal</h4>
              <table id="tablaEstadisticasPersonal" class="stats-table">
                <thead>
                  <tr>
                    <th>Personal</th>
                    <th>Tipo de Servicio</th>
                    <th>Cantidad</th>
                    <th>% del Total</th>
                  </tr>
                </thead>
                <tbody id="tablaEstadisticasBody">
                  <!-- Se llenará dinámicamente -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Sección de ediciones (solo admin) -->
      <section id="edicionesSection" class="hidden">
        <h2><i class="fas fa-history"></i> Historial de Ediciones</h2>
        
        <!-- Agregar controles de filtro -->
        <div class="filtros-ediciones" style="margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 16px; align-items: flex-end;">
          <div class="filtro-grupo">
            <label for="filtroPeriodoEdiciones">Período:</label>
            <select id="filtroPeriodoEdiciones">
              <option value="hoy">Hoy</option>
              <option value="semana">Esta semana</option>
              <option value="mes">Este mes</option>
              <option value="ano">Este año</option>
              <option value="personalizado">Personalizado</option>
              <option value="todo">Todo</option>
            </select>
          </div>
          <div id="periodPersonalizadoEdiciones" class="filtro-periodo-personalizado" style="display: none; gap: 8px;">
            <div class="filtro-fecha">
              <label for="fechaInicioEdiciones">Desde:</label>
              <input type="date" id="fechaInicioEdiciones">
            </div>
            <div class="filtro-fecha">
              <label for="fechaFinEdiciones">Hasta:</label>
              <input type="date" id="fechaFinEdiciones">
            </div>
          </div>
          <button id="aplicarFiltrosEdicionesBtn" class="btn-filtrar" style="margin-left: 8px;">
            <i class="fas fa-filter"></i> Aplicar filtros
          </button>
        </div>

        <!-- Agregar barra de búsqueda -->
        <div class="search-bar" style="margin-bottom: 20px;">
          <input type="text" id="searchEdiciones" placeholder="Buscar por nombre de mascota, ID, factura, nombre del dueño..." style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
          <i class="fas fa-search" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #666;"></i>
        </div>

        <div class="ediciones-container">
          <table class="stats-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Usuario</th>
                <th>Email</th>
                <th>ID Ticket</th>
                <th>Cliente</th>
                <th>Mascota</th>
                <th>Factura</th>
                <th>Cambios Realizados</th>
              </tr>
            </thead>
            <tbody id="edicionesTableBody">
              <!-- Se llenará dinámicamente -->
            </tbody>
          </table>

          <!-- Controles de paginación -->
          <div class="paginacion-container" style="margin-top: 20px; display: flex; justify-content: center; align-items: center; gap: 10px;">
            <button id="prevPage" class="btn-pagina" disabled>
              <i class="fas fa-chevron-left"></i> Anterior
            </button>
            <div id="numeroPaginas" style="display: flex; gap: 5px;">
              <!-- Se llenará dinámicamente -->
            </div>
            <button id="nextPage" class="btn-pagina">
              Siguiente <i class="fas fa-chevron-right"></i>
            </button>
            <div class="info-paginas" style="margin-left: 15px;">
              <span>Mostrando página <span id="paginaActual">1</span> de <span id="totalPaginas">1</span></span>
            </div>
          </div>
        </div>
      </section>

      <!-- Sección de horario -->
      <section id="horarioSection" class="hidden">
        <h2><i class="fas fa-calendar-alt"></i> Horario de Consultas</h2>
        
        <div class="date-controls">
          <input type="date" id="fechaHorario" value="">
                      <button id="verHorarioBtn">Ver horario</button>
        </div>
        
        <div class="export-controls">
          <button id="exportarDiaBtn"><i class="fas fa-file-export"></i> Exportar día</button>
          <button id="exportarMesBtn"><i class="fas fa-file-export"></i> Exportar mes</button>
          <button id="exportarGoogleBtn"><i class="fab fa-google"></i> Exportar a Google Sheets</button>
        </div>
        
        <div class="horario-container">
          <table id="tablaHorario" class="horario-table">
            <thead>
              <tr>
                <th>Hora</th>
                <th>Cliente</th>
                <th>Mascota</th>
                <th>Tipo Mascota</th>
                <th>Estado</th>
                <th>Urgencia</th>
                <th>Médico</th>
                <th>ID Paciente</th>
                <th>Factura</th>
                <th>Hora de Atención</th>
                <th>Por Cobrar</th>
                <th>Tipo Cita</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="horarioBody">
              <!-- Aquí se generarán las filas dinámicamente -->
            </tbody>
          </table>
        </div>
        
        <div class="backup-controls">
          <button id="backupBtn"><i class="fas fa-download"></i> Generar respaldo</button>
          <button id="cleanDataBtn"><i class="fas fa-broom"></i> Limpiar datos antiguos</button>
        </div>
      </section>

      <!-- Sección de Consentimientos -->
      <section id="consentimientosSection" class="hidden">
        <h2><i class="fas fa-file-contract"></i> Formularios de Consentimiento</h2>
        <!-- Pestañas de origen de datos -->
        <div class="consent-source-tabs">
          <button id="consentSourceConsulta" class="consent-source-btn active" data-source="consulta">
            <i class="fas fa-stethoscope"></i>
            <span>Consulta</span>
          </button>
          <button id="consentSourceQuirofano" class="consent-source-btn" data-source="quirofano">
            <i class="fas fa-cut"></i>
            <span>Quirófano</span>
          </button>
          <button id="consentSourceInternos" class="consent-source-btn" data-source="internos">
            <i class="fas fa-home"></i>
            <span>Internos</span>
          </button>
          <span id="consentCurrentSourceLabel" class="consent-source-label">Origen actual: Consulta</span>
        </div>
        
        <!-- Buscador de clientes -->
        <div class="client-search-section">
          <h3>Buscar Cliente</h3>
          <div class="search-container">
            <div class="search-input-container">
              <input type="text" id="consentClientSearch" placeholder="Buscar por nombre, cédula o nombre de mascota..." class="search-input">
              <button id="searchClientBtn" class="search-btn">
                Buscar
              </button>
            </div>
            <div id="clientSearchResults" class="search-results"></div>
          </div>
        </div>

        <!-- Selector de plantilla de consentimiento -->
        <div class="consent-template-section">
          <h3><i class="fas fa-file-medical"></i> Seleccionar Plantilla de Consentimiento</h3>
          <div class="template-grid">
            <div class="template-card" data-template="anestesia">
              <h4>Autorización para Anestesia</h4>
              <p>Consentimiento para procedimientos bajo anestesia</p>
            </div>
            <div class="template-card" data-template="cirugia">
              <h4>Consentimiento Cirugía</h4>
              <p>Autorización para procedimientos quirúrgicos</p>
            </div>
            <div class="template-card" data-template="emergencias">
              <h4>Emergencias</h4>
              <p>Consentimiento para atención de emergencias</p>
            </div>
            <div class="template-card" data-template="internamiento">
              <h4>Internamiento</h4>
              <p>Autorización para internamiento hospitalario</p>
            </div>
            <div class="template-card" data-template="transfusion">
              <h4>Transfusión</h4>
              <p>Consentimiento para transfusión sanguínea</p>
            </div>
            <div class="template-card" data-template="cesarea">
              <h4>Consentimiento Cesárea</h4>
              <p>Autorización para cesárea</p>
            </div>
            <div class="template-card" data-template="eutanasia">
              <h4>Consentimiento Eutanasia</h4>
              <p>Autorización para eutanasia humanitaria</p>
            </div>
            <div class="template-card" data-template="alta_voluntaria">
              <h4>Alta Voluntaria</h4>
              <p>Consentimiento informado por alta voluntaria</p>
            </div>
            <div class="template-card" data-template="control_anestesico">
              <h4>Control Anestésico</h4>
              <p>Control de anestesia y medicamentos administrados durante cirugía</p>
            </div>
          </div>
        </div>

        <!-- Iframe para mostrar el formulario seleccionado -->
        <div id="consentFormContainer" class="consent-form-container" style="display:none;">
          <div class="form-header">
            <h3 id="selectedFormTitle">Formulario Seleccionado</h3>
            <button id="closeFormBtn" class="close-btn">
              <i class="fas fa-times"></i> Cerrar
            </button>
          </div>
          <iframe id="consentFormIframe" src="" frameborder="0"></iframe>
        </div>
      </section>

  <!-- Plantillas para notificaciones y modales -->
  <div id="notificationContainer"></div>
  
  <!-- Modales -->
  <div id="editModal" class="modal hidden">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3>Editar Consulta</h3>
      <form id="editForm">
        <!-- El contenido del formulario se generará dinámicamente -->
      </form>
    </div>
  </div>
  
  <div id="statusModal" class="modal hidden">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3>Cambiar Estado</h3>
      <div id="statusOptions">
        <!-- Opciones de estado generadas dinámicamente -->
      </div>
      <div class="modal-actions">
        <button id="cancelStatusBtn">Cancelar</button>
        <button id="saveStatusBtn">Guardar</button>
      </div>
    </div>
  </div>

  <div id="adminModal" class="modal hidden">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3><i class="fas fa-shield-alt"></i> Panel de Administración</h3>
      <div id="adminContent">
        <!-- Content will be loaded dynamically -->
      </div>
    </div>
  </div>

  <!-- Modal de administración de usuarios -->
<div id="adminUsersModal" class="edit-modal" style="display:none;z-index:2000;">
  <div class="modal-content animate-scale" style="max-width:420px;">
    <span class="close-modal" id="closeAdminUsersModal" style="float:right;cursor:pointer;font-size:1.5rem;">&times;</span>
    <h3><i class="fas fa-users-cog"></i> Administración de Usuarios</h3>
    <form id="createUserForm">
      <div class="form-group">
        <label for="newUserEmail">Correo electrónico</label>
        <input type="email" id="newUserEmail" required>
      </div>
      <div class="form-group">
        <label for="newUserName">Nombre</label>
        <input type="text" id="newUserName" required>
      </div>
      <div class="form-group">
        <label for="newUserRole">Rol</label>
        <select id="newUserRole" required>
          <option value="recepcion">Recepción</option>
          <option value="consulta_externa">Consulta Externa</option>
          <option value="quirofano">Quirofano</option>
          <option value="internos">Internos</option>
          <option value="visitas">Visitas</option>
        </select>
      </div>
      <button type="submit" class="btn-save" style="width:100%;margin-bottom:10px;">Crear usuario</button>
    </form>
  </div>
</div>

  <!-- External scripts - keep these external references -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
  emailjs.init('ZiyjOCMRsBnxJn_LT');
</script>
  <script src="js/firebase-config.js"></script>
  <!-- Módulos de optimización de tiempo real -->
  <script src="js/firebase-realtime-optimizer.js"></script>
  <script src="js/billing-performance-optimizer.js"></script>
  <script src="js/services-data.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/laboratorio.js"></script>

<script src="js/consentimientos-module.js"></script>
<script src="js/quirofano-module.js"></script>
  <script src="js/reportes-lab-module.js"></script>
  <script src="js/index.js"></script>
<script src="js/internamiento.js"></script>
<script>
// Verificación simple de carga del módulo de Internamiento
setTimeout(() => {
  if (typeof window.navigateToInternamiento === 'function') {
    console.log('✓ Módulo de Internamiento cargado correctamente');
  } else {
    console.error('✗ Error: Módulo de Internamiento no se cargó correctamente');
  }
}, 1000);
</script>
  <script src="js/wait-time-chart-fix.js"></script>
  <script src="js/admin-users.js"></script>
  <script src="js/laboratory-search-fix.js"></script>
  <script src="js/services-selection-manager.js"></script>
  <!-- Inicialización de optimizaciones -->
  <script src="js/realtime-performance-manager.js"></script>
  <!-- Optimizador de memoria -->
  <script src="js/memory-optimizer.js"></script>
  <!-- Herramientas de diagnóstico (solo en desarrollo) -->
  <script src="js/diagnostico-tiempo-real.js"></script>
  <script src="js/memory-diagnostic.js"></script>
  
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tipoMascota = document.getElementById('tipoMascota');
  const conejoImg = document.getElementById('conejoImg');
  if (tipoMascota && conejoImg) {
    tipoMascota.addEventListener('change', function() {
      conejoImg.style.display = tipoMascota.value === 'conejo' ? 'inline-block' : 'none';
    });
  }

  // Ocultar campo Hora de Cita según el rol
  const userRole = sessionStorage.getItem('userRole');
  const horaCitaGroup = document.querySelector('input#hora')?.closest('.form-group');
  if (horaCitaGroup) {
    if (!["admin", "recepción", "quirofano"].includes(userRole)) {
      horaCitaGroup.style.display = 'none';
    } else {
      horaCitaGroup.style.display = '';
    }
  }

  // Descripciones para cada categorización
  const urgenciaDescriptions = {
    emergencia: 'Emergencias. Situaciones críticas que requieren atención médica inmediata. Se mostrará como EMERGENCIA en el ticket.',
    urgencia: 'Urgencias. Problemas de salud que deben atenderse pronto, pero no son críticos.',
    leve: 'Leve. Puede esperar, sin riesgo inmediato.',
    consulta: 'Consulta. Atención general o rutinaria.'
  };

  function updateUrgenciaDescription(selectId, descId) {
    const select = document.getElementById(selectId);
    const desc = document.getElementById(descId);
    if (!select || !desc) return;
    const value = select.value;
    desc.textContent = urgenciaDescriptions[value] || '';
  }

  // Descripción dinámica en creación
  const urgenciaSelect = document.getElementById('urgencia');
  if (urgenciaSelect) {
    const descDiv = document.createElement('div');
    descDiv.id = 'urgenciaDesc';
    descDiv.style.fontSize = '0.95em';
    descDiv.style.color = '#1976d2';
    descDiv.style.marginTop = '4px';
    urgenciaSelect.parentNode.appendChild(descDiv);
    urgenciaSelect.addEventListener('change', function() {
      updateUrgenciaDescription('urgencia', 'urgenciaDesc');
    });
    updateUrgenciaDescription('urgencia', 'urgenciaDesc');
  }
});

// Navegación with flechas en el formulario de tickets
(function() {
  const form = document.getElementById('ticketForm');
  if (!form) return;
  // Selecciona todos los inputs, selects y textareas visibles en orden
  const getFields = () => Array.from(form.querySelectorAll('input, select, textarea')).filter(el => el.offsetParent !== null && !el.disabled);

  form.addEventListener('keydown', function(e) {
    const fields = getFields();
    const idx = fields.indexOf(document.activeElement);
    if (idx === -1) return;
    // Columnas por fila (ajustar si cambias el diseño)
    const cols = 2;
    // Flecha abajo
    if (e.key === 'ArrowDown') {
      if (idx + cols < fields.length) {
        fields[idx + cols].focus();
        e.preventDefault();
      }
    }
    // Flecha arriba
    else if (e.key === 'ArrowUp') {
      if (idx - cols >= 0) {
        fields[idx - cols].focus();
        e.preventDefault();
      }
    }
    // Flecha derecha
    else if (e.key === 'ArrowRight') {
      if ((idx + 1) % cols !== 0 && idx + 1 < fields.length) {
        fields[idx + 1].focus();
        e.preventDefault();
      }
    }
    // Flecha izquierda
    else if (e.key === 'ArrowLeft') {
      if (idx % cols !== 0 && idx - 1 >= 0) {
        fields[idx - 1].focus();
        e.preventDefault();
      }
    }
  });
})();
</script>

</body>
</html>